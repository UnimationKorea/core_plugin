<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>êµìœ¡ìš© ë ˆìŠ¨ í”Œë«í¼ - ìƒˆë¡œìš´ ì•ˆì „í•œ êµ¬ì¡°</title>
  <style>
    /* ê¸°ë³¸ ë³€ìˆ˜ ì •ì˜ */
    :root {
      --primary: #3b82f6;
      --primary-dark: #1d4ed8;
      --secondary: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-tertiary: #334155;
      --text-primary: #f8fafc;
      --text-secondary: #cbd5e1;
      --text-muted: #64748b;
      --border: #475569;
      --border-light: #334155;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    /* ê¸°ë³¸ ë¦¬ì…‹ */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans KR', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      overflow: hidden;
    }

    /* ë©”ì¸ ë ˆì´ì•„ì›ƒ */
    .app {
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* í—¤ë” */
    .header {
      height: 60px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      padding: 0 20px;
      flex-shrink: 0;
    }

    .header h1 {
      font-size: 18px;
      font-weight: 600;
      margin-right: 20px;
    }

    .nav-tabs {
      display: flex;
      gap: 4px;
    }

    .nav-tab {
      padding: 8px 16px;
      background: transparent;
      color: var(--text-secondary);
      border: 1px solid transparent;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 14px;
    }

    .nav-tab:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .nav-tab.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    /* ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ */
    .main {
      flex: 1;
      display: flex;
      min-height: 0;
    }

    /* ì‚¬ì´ë“œë°” */
    .sidebar {
      width: 320px;
      background: var(--bg-secondary);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
    }

    .sidebar-content {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }

    /* ì»¨í…ì¸  ì˜ì—­ */
    .content {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .content-panel {
      display: none;
      flex: 1;
      min-height: 0;
    }

    .content-panel.active {
      display: flex;
      flex-direction: column;
    }

    /* í”Œë ˆì´ì–´ íŒ¨ë„ */
    .player-panel {
      padding: 20px;
      gap: 20px;
    }

    .player-header {
      background: var(--bg-secondary);
      padding: 16px 20px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
    }

    .lesson-info h2 {
      font-size: 20px;
      margin-bottom: 4px;
    }

    .lesson-meta {
      color: var(--text-secondary);
      font-size: 14px;
    }

    .progress-bar {
      width: 200px;
      height: 8px;
      background: var(--bg-tertiary);
      border-radius: 4px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      width: 0%;
      transition: width 0.3s ease;
    }

    /* í™œë™ ì»¨í…Œì´ë„ˆ - ê°€ì¥ ì¤‘ìš”í•œ ë¶€ë¶„ */
    .activity-container {
      flex: 1;
      background: var(--bg-secondary);
      border-radius: 12px;
      margin: 20px 0;
      padding: 24px;
      min-height: 400px;
      height: calc(100vh - 300px); /* ê³ ì •ëœ ê³„ì‚°ëœ ë†’ì´ */
      max-height: calc(100vh - 300px);
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .activity-placeholder {
      text-align: center;
      color: var(--text-muted);
      font-size: 16px;
    }

    .activity-content {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 300px;
    }

    /* í”Œë ˆì´ì–´ ì»¨íŠ¸ë¡¤ */
    .player-controls {
      background: var(--bg-secondary);
      padding: 16px 20px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
    }

    .control-group {
      display: flex;
      gap: 8px;
    }

    /* ë¹Œë” íŒ¨ë„ */
    .builder-panel {
      padding: 20px;
      gap: 20px;
    }

    .builder-toolbar {
      background: var(--bg-secondary);
      padding: 16px 20px;
      border-radius: 8px;
      display: flex;
      gap: 12px;
      align-items: center;
      flex-shrink: 0;
    }

    .builder-workspace {
      flex: 1;
      background: var(--bg-secondary);
      border-radius: 12px;
      padding: 20px;
      min-height: 500px;
      overflow-y: auto;
    }

    /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .btn {
      padding: 8px 16px;
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border: 1px solid var(--border);
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .btn:hover {
      background: var(--border);
      transform: translateY(-1px);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn-primary {
      background: var(--primary);
      border-color: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
      border-color: var(--primary-dark);
    }

    .btn-secondary {
      background: var(--secondary);
      border-color: var(--secondary);
      color: white;
    }

    .btn-danger {
      background: var(--danger);
      border-color: var(--danger);
      color: white;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* í¼ ìš”ì†Œ */
    .form-group {
      margin-bottom: 16px;
    }

    .form-label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
      color: var(--text-secondary);
      font-size: 14px;
    }

    .form-select, .form-input {
      width: 100%;
      padding: 10px 12px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text-primary);
      font-size: 14px;
    }

    .form-select:focus, .form-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
    }

    /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-light);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--text-primary);
    }

    /* ë ˆìŠ¨ ëª©ë¡ */
    .lesson-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .lesson-item {
      padding: 12px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-light);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .lesson-item:hover {
      background: var(--border);
      transform: translateY(-1px);
    }

    .lesson-title {
      font-weight: 500;
      color: var(--text-primary);
    }

    .lesson-meta-small {
      font-size: 12px;
      color: var(--text-muted);
    }

    /* í…œí”Œë¦¿ ì»¨í…Œì´ë„ˆ */
    .template-video {
      width: 100%;
      max-width: 600px;
      background: black;
      border-radius: 8px;
      margin: 0 auto;
    }

    .template-video video {
      width: 100%;
      height: auto;
      max-height: 400px;
      border-radius: 8px;
    }

    .template-drag-drop {
      width: 100%;
      max-width: 700px;
      margin: 0 auto;
      padding: 20px;
    }

    .prompt-text {
      font-size: 20px;
      text-align: center;
      margin-bottom: 30px;
      color: var(--text-primary);
    }

    .drop-zone {
      min-height: 80px;
      border: 2px dashed var(--border);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
      transition: all 0.2s;
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      font-size: 16px;
    }

    .drop-zone.drag-over {
      border-color: var(--primary);
      background: rgba(59, 130, 246, 0.1);
      color: var(--primary);
    }

    .choices-container {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
    }

    .choice-item {
      padding: 12px 20px;
      background: var(--primary);
      color: white;
      border-radius: 8px;
      cursor: grab;
      user-select: none;
      transition: all 0.2s;
      font-weight: 500;
    }

    .choice-item:hover {
      background: var(--primary-dark);
      transform: scale(1.05);
    }

    .choice-item:active {
      cursor: grabbing;
    }

    /* ì•Œë¦¼ ë©”ì‹œì§€ */
    .notification {
      position: fixed;
      top: 80px;
      right: 20px;
      padding: 12px 16px;
      border-radius: 8px;
      color: white;
      font-weight: 500;
      z-index: 1000;
      min-width: 250px;
      animation: slideIn 0.3s ease;
    }

    .notification.success {
      background: var(--secondary);
    }

    .notification.error {
      background: var(--danger);
    }

    .notification.info {
      background: var(--primary);
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* ë¡œë”© ìƒíƒœ */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      color: var(--text-secondary);
    }

    .spinner {
      width: 20px;
      height: 20px;
      border: 2px solid var(--border);
      border-top: 2px solid var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* íŒì—… í”Œë ˆì´ì–´ ìŠ¤íƒ€ì¼ */
    .popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 10000;
      display: none;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .popup-overlay.active {
      display: flex;
    }

    .popup-player {
      background: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: 12px;
      width: 90%;
      max-width: 800px;
      height: 90%;
      max-height: 600px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    }

    .popup-header {
      background: var(--bg-secondary);
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
    }

    .popup-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
    }

    .popup-close {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 24px;
      cursor: pointer;
      padding: 4px;
      border-radius: 4px;
      transition: all 0.2s;
    }

    .popup-close:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .popup-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .popup-activity-area {
      flex: 1;
      padding: 20px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 300px;
      background: var(--bg-secondary);
      margin: 20px;
      border-radius: 8px;
    }

    .popup-controls {
      background: var(--bg-secondary);
      padding: 16px 20px;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
    }

    .popup-progress {
      flex: 1;
      margin: 0 20px;
    }

    .popup-progress-bar {
      width: 100%;
      height: 6px;
      background: var(--bg-tertiary);
      border-radius: 3px;
      overflow: hidden;
    }

    .popup-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      width: 0%;
      transition: width 0.3s ease;
    }

    /* ë°˜ì‘í˜• ë””ìì¸ */
    @media (max-width: 768px) {
      .sidebar {
        position: fixed;
        left: -320px;
        top: 60px;
        height: calc(100vh - 60px);
        z-index: 100;
        transition: left 0.3s ease;
      }

      .sidebar.open {
        left: 0;
      }

      .activity-container {
        height: calc(100vh - 260px);
        max-height: calc(100vh - 260px);
      }

      .player-controls {
        flex-direction: column;
        gap: 12px;
      }

      .control-group {
        width: 100%;
        justify-content: center;
      }

      .popup-player {
        width: 95%;
        height: 95%;
        max-height: 95vh;
      }

      .popup-controls {
        flex-direction: column;
        gap: 12px;
      }

      .popup-progress {
        order: -1;
        margin: 0;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- í—¤ë” -->
    <header class="header">
      <h1>êµìœ¡ìš© ë ˆìŠ¨ í”Œë«í¼</h1>
      <nav class="nav-tabs">
        <button class="nav-tab active" data-tab="player">í”Œë ˆì´ì–´</button>
        <button class="nav-tab" data-tab="builder">ë¹Œë”</button>
      </nav>
    </header>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="main">
      <!-- ì‚¬ì´ë“œë°” -->
      <aside class="sidebar">
        <div class="sidebar-content">
          <!-- í”Œë ˆì´ì–´ ì‚¬ì´ë“œë°” -->
          <div id="player-sidebar" class="sidebar-panel">
            <div class="card">
              <div class="card-title">ë ˆìŠ¨ ë¡œë“œ</div>
              
              <div class="form-group">
                <label class="form-label">ìƒ˜í”Œ ë ˆìŠ¨ ì„ íƒ</label>
                <select class="form-select" id="lesson-select">
                  <option value="">-- ë ˆìŠ¨ì„ ì„ íƒí•˜ì„¸ìš” --</option>
                  <option value="sample1">ê¸°ì´ˆ ì˜ì–´ íšŒí™”</option>
                  <option value="sample2">ìˆ˜í•™ ê¸°ì´ˆ ì—°ì‚°</option>
                  <option value="sample3">ê³¼í•™ ì‹¤í—˜</option>
                </select>
              </div>

              <div style="display: flex; gap: 8px;">
                <button class="btn btn-primary" id="load-lesson-btn" disabled>
                  ë ˆìŠ¨ ë¡œë“œ
                </button>
                <button class="btn btn-secondary" id="popup-player-btn" disabled>
                  íŒì—… í”Œë ˆì´ì–´
                </button>
              </div>
            </div>

            <div class="card">
              <div class="card-title">íŒŒì¼ ì—…ë¡œë“œ</div>
              <input type="file" class="form-input" id="file-input" accept=".json">
            </div>

            <!-- í˜„ì¬ ë ˆìŠ¨ ì •ë³´ -->
            <div class="card" id="current-lesson-info" style="display: none;">
              <div class="card-title">í˜„ì¬ ë ˆìŠ¨</div>
              <div id="lesson-details">
                <div class="lesson-title" id="current-lesson-title">-</div>
                <div class="lesson-meta-small" id="current-lesson-meta">-</div>
              </div>
            </div>
          </div>

          <!-- ë¹Œë” ì‚¬ì´ë“œë°” -->
          <div id="builder-sidebar" class="sidebar-panel" style="display: none;">
            <div class="card">
              <div class="card-title">í…œí”Œë¦¿ ë¼ì´ë¸ŒëŸ¬ë¦¬</div>
              <div class="lesson-list">
                <div class="lesson-item" data-template="video">
                  <div>
                    <div class="lesson-title">ë¹„ë””ì˜¤ í…œí”Œë¦¿</div>
                    <div class="lesson-meta-small">ì˜ìƒ í•™ìŠµìš©</div>
                  </div>
                </div>
                <div class="lesson-item" data-template="drag-drop">
                  <div>
                    <div class="lesson-title">ë“œë˜ê·¸ì•¤ë“œë¡­</div>
                    <div class="lesson-meta-small">ìƒí˜¸ì‘ìš© í€´ì¦ˆ</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </aside>

      <!-- ì»¨í…ì¸  ì˜ì—­ -->
      <div class="content">
        <!-- í”Œë ˆì´ì–´ íŒ¨ë„ -->
        <div class="content-panel active player-panel" id="player-panel">
          <!-- í”Œë ˆì´ì–´ í—¤ë” -->
          <div class="player-header">
            <div class="lesson-info">
              <h2 id="player-lesson-title">ë ˆìŠ¨ì„ ì„ íƒí•´ì£¼ì„¸ìš”</h2>
              <div class="lesson-meta">
                <span id="activity-counter">0 / 0</span> â€¢
                <span id="current-template">í…œí”Œë¦¿ ì—†ìŒ</span>
              </div>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" id="progress-fill"></div>
            </div>
          </div>

          <!-- í™œë™ ì»¨í…Œì´ë„ˆ -->
          <div class="activity-container" id="activity-container">
            <div class="activity-placeholder">
              <p>ì¢Œì¸¡ì—ì„œ ë ˆìŠ¨ì„ ì„ íƒí•˜ì—¬ ì‹œì‘í•˜ì„¸ìš”</p>
            </div>
          </div>

          <!-- í”Œë ˆì´ì–´ ì»¨íŠ¸ë¡¤ -->
          <div class="player-controls">
            <div class="control-group">
              <button class="btn" id="prev-btn" disabled>ì´ì „</button>
              <button class="btn btn-primary" id="next-btn" disabled>ë‹¤ìŒ</button>
            </div>
            <div class="control-group">
              <button class="btn btn-secondary" id="restart-btn" disabled>ì¬ì‹œì‘</button>
              <button class="btn btn-danger" id="finish-btn" disabled>ì¢…ë£Œ</button>
            </div>
          </div>
        </div>

        <!-- ë¹Œë” íŒ¨ë„ -->
        <div class="content-panel builder-panel" id="builder-panel">
          <!-- ë¹Œë” íˆ´ë°” -->
          <div class="builder-toolbar">
            <button class="btn btn-primary">ìƒˆ ë ˆìŠ¨</button>
            <button class="btn">ì €ì¥</button>
            <button class="btn">ë¯¸ë¦¬ë³´ê¸°</button>
          </div>

          <!-- ë¹Œë” ì‘ì—…ê³µê°„ -->
          <div class="builder-workspace">
            <div class="activity-placeholder">
              <p>ë ˆìŠ¨ ë¹Œë” ì‘ì—…ê³µê°„</p>
              <p>ì¢Œì¸¡ì—ì„œ í…œí”Œë¦¿ì„ ì„ íƒí•˜ì—¬ ì‹œì‘í•˜ì„¸ìš”</p>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- íŒì—… í”Œë ˆì´ì–´ -->
  <div class="popup-overlay" id="popup-overlay">
    <div class="popup-player">
      <div class="popup-header">
        <h3 class="popup-title" id="popup-lesson-title">íŒì—… í”Œë ˆì´ì–´</h3>
        <button class="popup-close" id="popup-close">Ã—</button>
      </div>
      
      <div class="popup-content">
        <div class="popup-activity-area" id="popup-activity-area">
          <div class="activity-placeholder">
            <p>íŒì—… í”Œë ˆì´ì–´ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
            <p>ë ˆìŠ¨ì„ ì‹œì‘í•˜ë ¤ë©´ ì•„ë˜ ì»¨íŠ¸ë¡¤ì„ ì‚¬ìš©í•˜ì„¸ìš”.</p>
          </div>
        </div>
      </div>

      <div class="popup-controls">
        <div class="control-group">
          <button class="btn" id="popup-prev-btn" disabled>ì´ì „</button>
          <button class="btn btn-primary" id="popup-next-btn" disabled>ë‹¤ìŒ</button>
        </div>
        
        <div class="popup-progress">
          <div class="popup-progress-bar">
            <div class="popup-progress-fill" id="popup-progress-fill"></div>
          </div>
        </div>

        <div class="control-group">
          <button class="btn btn-secondary" id="popup-restart-btn" disabled>ì¬ì‹œì‘</button>
          <button class="btn btn-danger" id="popup-finish-btn" disabled>ì¢…ë£Œ</button>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript -->
  <script>
    // ì•ˆì „í•œ ë ˆìŠ¨ í”Œë«í¼ í´ë˜ìŠ¤
    class SafeLessonPlatform {
      constructor() {
        this.currentLesson = null;
        this.currentActivityIndex = 0;
        this.activities = [];
        this.results = [];
        
        this.init();
      }

      init() {
        this.setupNavigation();
        this.setupLessonLoader();
        this.setupPlayerControls();
        this.loadSampleLessons();
        
        console.log('âœ… ì•ˆì „í•œ ë ˆìŠ¨ í”Œë«í¼ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
      }

      // ë„¤ë¹„ê²Œì´ì…˜ ì„¤ì •
      setupNavigation() {
        const tabs = document.querySelectorAll('.nav-tab');
        const panels = document.querySelectorAll('.content-panel');
        const sidebars = document.querySelectorAll('.sidebar-panel');

        tabs.forEach(tab => {
          tab.addEventListener('click', () => {
            const targetTab = tab.dataset.tab;
            
            // íƒ­ í™œì„±í™”
            tabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            
            // íŒ¨ë„ ì „í™˜
            panels.forEach(panel => {
              panel.classList.remove('active');
              if (panel.id === `${targetTab}-panel`) {
                panel.classList.add('active');
              }
            });
            
            // ì‚¬ì´ë“œë°” ì „í™˜
            sidebars.forEach(sidebar => {
              sidebar.style.display = 'none';
              if (sidebar.id === `${targetTab}-sidebar`) {
                sidebar.style.display = 'block';
              }
            });
          });
        });
      }

      // ë ˆìŠ¨ ë¡œë” ì„¤ì •
      setupLessonLoader() {
        const select = document.getElementById('lesson-select');
        const loadBtn = document.getElementById('load-lesson-btn');
        const popupBtn = document.getElementById('popup-player-btn');
        const fileInput = document.getElementById('file-input');

        select.addEventListener('change', () => {
          const hasValue = !!select.value;
          loadBtn.disabled = !hasValue;
          popupBtn.disabled = !hasValue;
        });

        loadBtn.addEventListener('click', () => {
          this.loadLesson(select.value);
        });

        // íŒì—… í”Œë ˆì´ì–´ ë²„íŠ¼
        popupBtn.addEventListener('click', () => {
          this.openPopupPlayer(select.value);
        });

        fileInput.addEventListener('change', (e) => {
          const file = e.target.files[0];
          if (file) {
            this.loadLessonFromFile(file);
          }
        });

        // íŒì—… ì»¨íŠ¸ë¡¤ ì„¤ì •
        this.setupPopupControls();
      }

      // í”Œë ˆì´ì–´ ì»¨íŠ¸ë¡¤ ì„¤ì •
      setupPlayerControls() {
        document.getElementById('prev-btn').addEventListener('click', () => {
          this.previousActivity();
        });
        
        document.getElementById('next-btn').addEventListener('click', () => {
          this.nextActivity();
        });
        
        document.getElementById('restart-btn').addEventListener('click', () => {
          this.restartLesson();
        });
        
        document.getElementById('finish-btn').addEventListener('click', () => {
          this.finishLesson();
        });
      }

      // ìƒ˜í”Œ ë ˆìŠ¨ ë¡œë“œ
      loadSampleLessons() {
        // ì•ˆì „í•œ ìƒ˜í”Œ ë°ì´í„°
        this.sampleLessons = {
          sample1: {
            title: "ê¸°ì´ˆ ì˜ì–´ íšŒí™”",
            activities: [
              {
                type: "video",
                title: "ì¸ì‚¬ë§ ë°°ìš°ê¸°",
                content: {
                  src: "https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4",
                  description: "ê¸°ë³¸ ì¸ì‚¬ë§ì„ ë°°ì›Œë³´ì„¸ìš”"
                }
              },
              {
                type: "drag-drop",
                title: "ë‹¨ì–´ ë§ì¶”ê¸°",
                content: {
                  prompt: "ì•Œë§ì€ ì¸ì‚¬ë§ì„ ì„ íƒí•˜ì„¸ìš”: Good ____",
                  choices: ["morning", "night", "bye", "hello"],
                  answer: "morning"
                }
              }
            ]
          },
          sample2: {
            title: "ìˆ˜í•™ ê¸°ì´ˆ ì—°ì‚°",
            activities: [
              {
                type: "drag-drop",
                title: "ë§ì…ˆ ë¬¸ì œ",
                content: {
                  prompt: "2 + 3 = ?",
                  choices: ["4", "5", "6", "7"],
                  answer: "5"
                }
              }
            ]
          },
          sample3: {
            title: "ê³¼í•™ ì‹¤í—˜",
            activities: [
              {
                type: "video",
                title: "ë¬¼ì˜ ìˆœí™˜",
                content: {
                  src: "https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4",
                  description: "ë¬¼ì˜ ìˆœí™˜ ê³¼ì •ì„ ì•Œì•„ë³´ì„¸ìš”"
                }
              }
            ]
          }
        };
      }

      // ë ˆìŠ¨ ë¡œë“œ
      async loadLesson(lessonId) {
        try {
          this.showNotification('ë ˆìŠ¨ì„ ë¡œë“œí•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'info');
          
          const lesson = this.sampleLessons[lessonId];
          if (!lesson) {
            throw new Error('ë ˆìŠ¨ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          }

          this.currentLesson = lesson;
          this.activities = lesson.activities;
          this.currentActivityIndex = 0;
          this.results = [];

          this.updateLessonInfo();
          this.loadActivity(0);
          this.updateControls();
          
          this.showNotification('ë ˆìŠ¨ì´ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          
        } catch (error) {
          console.error('ë ˆìŠ¨ ë¡œë“œ ì‹¤íŒ¨:', error);
          this.showNotification('ë ˆìŠ¨ ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
        }
      }

      // íŒŒì¼ì—ì„œ ë ˆìŠ¨ ë¡œë“œ
      async loadLessonFromFile(file) {
        try {
          const text = await file.text();
          const lessonData = JSON.parse(text);
          
          // ê°„ë‹¨í•œ ìœ íš¨ì„± ê²€ì‚¬
          if (!lessonData.title || !lessonData.activities) {
            throw new Error('ì˜¬ë°”ë¥¸ ë ˆìŠ¨ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');
          }

          this.currentLesson = lessonData;
          this.activities = lessonData.activities;
          this.currentActivityIndex = 0;
          this.results = [];

          this.updateLessonInfo();
          this.loadActivity(0);
          this.updateControls();
          
          this.showNotification('íŒŒì¼ì—ì„œ ë ˆìŠ¨ì´ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          
        } catch (error) {
          console.error('íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨:', error);
          this.showNotification('íŒŒì¼ ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
        }
      }

      // ë ˆìŠ¨ ì •ë³´ ì—…ë°ì´íŠ¸
      updateLessonInfo() {
        if (!this.currentLesson) return;

        document.getElementById('player-lesson-title').textContent = this.currentLesson.title;
        document.getElementById('current-lesson-title').textContent = this.currentLesson.title;
        document.getElementById('current-lesson-meta').textContent = `${this.activities.length}ê°œ í™œë™`;
        document.getElementById('current-lesson-info').style.display = 'block';
      }

      // í™œë™ ë¡œë“œ
      loadActivity(index) {
        if (!this.activities || index < 0 || index >= this.activities.length) {
          return;
        }

        const activity = this.activities[index];
        const container = document.getElementById('activity-container');
        
        // í™œë™ ì¹´ìš´í„° ì—…ë°ì´íŠ¸
        document.getElementById('activity-counter').textContent = `${index + 1} / ${this.activities.length}`;
        document.getElementById('current-template').textContent = activity.type;
        
        // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
        const progress = ((index) / this.activities.length) * 100;
        document.getElementById('progress-fill').style.width = `${progress}%`;

        try {
          // ì•ˆì „í•œ í…œí”Œë¦¿ ë Œë”ë§
          if (activity.type === 'video') {
            this.renderVideoActivity(container, activity);
          } else if (activity.type === 'drag-drop') {
            this.renderDragDropActivity(container, activity);
          } else {
            throw new Error(`ì§€ì›í•˜ì§€ ì•ŠëŠ” í™œë™ ìœ í˜•: ${activity.type}`);
          }
        } catch (error) {
          console.error('í™œë™ ë¡œë“œ ì‹¤íŒ¨:', error);
          container.innerHTML = `
            <div class="activity-placeholder">
              <p>í™œë™ì„ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤</p>
              <p>${error.message}</p>
            </div>
          `;
        }
      }

      // ë¹„ë””ì˜¤ í™œë™ ë Œë”ë§
      renderVideoActivity(container, activity) {
        container.innerHTML = `
          <div class="activity-content">
            <div class="template-video">
              <h3 style="text-align: center; margin-bottom: 20px; color: var(--text-primary);">
                ${activity.title}
              </h3>
              <video controls style="width: 100%; max-height: 400px; border-radius: 8px;">
                <source src="${activity.content.src}" type="video/mp4">
                ì´ ë¸Œë¼ìš°ì €ëŠ” ë¹„ë””ì˜¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
              </video>
              <p style="text-align: center; margin-top: 16px; color: var(--text-secondary);">
                ${activity.content.description || 'ë¹„ë””ì˜¤ë¥¼ ì‹œì²­í•˜ê³  ë‹¤ìŒ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.'}
              </p>
            </div>
          </div>
        `;
      }

      // ë“œë˜ê·¸ì•¤ë“œë¡­ í™œë™ ë Œë”ë§
      renderDragDropActivity(container, activity) {
        container.innerHTML = `
          <div class="activity-content">
            <div class="template-drag-drop">
              <h3 style="text-align: center; margin-bottom: 20px; color: var(--text-primary);">
                ${activity.title}
              </h3>
              <div class="prompt-text">${activity.content.prompt}</div>
              <div class="drop-zone" id="drop-zone">
                ì •ë‹µì„ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ì„¸ìš”
              </div>
              <div class="choices-container" id="choices-container">
                ${activity.content.choices.map(choice => `
                  <div class="choice-item" draggable="true" data-choice="${choice}">
                    ${choice}
                  </div>
                `).join('')}
              </div>
            </div>
          </div>
        `;

        // ë“œë˜ê·¸ì•¤ë“œë¡­ ì´ë²¤íŠ¸ ì„¤ì •
        this.setupDragAndDrop(activity.content.answer);
      }

      // ë“œë˜ê·¸ì•¤ë“œë¡­ ì´ë²¤íŠ¸ ì„¤ì •
      setupDragAndDrop(correctAnswer) {
        const dropZone = document.getElementById('drop-zone');
        const choices = document.querySelectorAll('.choice-item');

        choices.forEach(choice => {
          choice.addEventListener('dragstart', (e) => {
            e.dataTransfer.setData('text/plain', e.target.dataset.choice);
          });
          
          // í´ë¦­ìœ¼ë¡œë„ ì„ íƒ ê°€ëŠ¥
          choice.addEventListener('click', (e) => {
            const selectedChoice = e.target.dataset.choice;
            this.handleChoice(selectedChoice, correctAnswer, dropZone);
          });
        });

        dropZone.addEventListener('dragover', (e) => {
          e.preventDefault();
          dropZone.classList.add('drag-over');
        });

        dropZone.addEventListener('dragleave', () => {
          dropZone.classList.remove('drag-over');
        });

        dropZone.addEventListener('drop', (e) => {
          e.preventDefault();
          dropZone.classList.remove('drag-over');
          const selectedChoice = e.dataTransfer.getData('text/plain');
          this.handleChoice(selectedChoice, correctAnswer, dropZone);
        });
      }

      // ì„ íƒ ì²˜ë¦¬
      handleChoice(selectedChoice, correctAnswer, dropZone) {
        const isCorrect = selectedChoice === correctAnswer;
        
        dropZone.textContent = `ì„ íƒë¨: ${selectedChoice}`;
        dropZone.style.backgroundColor = isCorrect ? 'rgba(16, 185, 129, 0.2)' : 'rgba(239, 68, 68, 0.2)';
        dropZone.style.borderColor = isCorrect ? 'var(--secondary)' : 'var(--danger)';
        
        // ê²°ê³¼ ì €ì¥
        this.results[this.currentActivityIndex] = {
          selected: selectedChoice,
          correct: correctAnswer,
          isCorrect: isCorrect,
          timestamp: Date.now()
        };

        if (isCorrect) {
          setTimeout(() => {
            this.showNotification('ì •ë‹µì…ë‹ˆë‹¤!', 'success');
          }, 500);
        } else {
          setTimeout(() => {
            this.showNotification('ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.', 'error');
          }, 500);
        }
      }

      // ì´ì „ í™œë™
      previousActivity() {
        if (this.currentActivityIndex > 0) {
          this.currentActivityIndex--;
          this.loadActivity(this.currentActivityIndex);
          this.updateControls();
        }
      }

      // ë‹¤ìŒ í™œë™
      nextActivity() {
        if (this.currentActivityIndex < this.activities.length - 1) {
          this.currentActivityIndex++;
          this.loadActivity(this.currentActivityIndex);
          this.updateControls();
        } else {
          this.finishLesson();
        }
      }

      // ë ˆìŠ¨ ì¬ì‹œì‘
      restartLesson() {
        if (confirm('ë ˆìŠ¨ì„ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          this.currentActivityIndex = 0;
          this.results = [];
          this.loadActivity(0);
          this.updateControls();
          this.showNotification('ë ˆìŠ¨ì´ ì¬ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        }
      }

      // ë ˆìŠ¨ ì¢…ë£Œ
      finishLesson() {
        const correctAnswers = this.results.filter(r => r && r.isCorrect).length;
        const totalAnswers = this.results.filter(r => r).length;
        const percentage = totalAnswers > 0 ? Math.round((correctAnswers / totalAnswers) * 100) : 0;

        alert(`ë ˆìŠ¨ ì™„ë£Œ!
        
ì •ë‹µë¥ : ${percentage}% (${correctAnswers}/${totalAnswers})
ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤!`);

        // ì´ˆê¸° ìƒíƒœë¡œ ë³µì›
        this.currentLesson = null;
        this.currentActivityIndex = 0;
        this.activities = [];
        this.results = [];
        
        document.getElementById('activity-container').innerHTML = `
          <div class="activity-placeholder">
            <p>ì¢Œì¸¡ì—ì„œ ë ˆìŠ¨ì„ ì„ íƒí•˜ì—¬ ì‹œì‘í•˜ì„¸ìš”</p>
          </div>
        `;
        
        this.updateControls();
        document.getElementById('current-lesson-info').style.display = 'none';
      }

      // ì»¨íŠ¸ë¡¤ ìƒíƒœ ì—…ë°ì´íŠ¸
      updateControls() {
        const hasLesson = this.currentLesson !== null;
        const hasPrevious = hasLesson && this.currentActivityIndex > 0;
        const hasNext = hasLesson && this.currentActivityIndex < this.activities.length - 1;

        document.getElementById('prev-btn').disabled = !hasPrevious;
        document.getElementById('next-btn').disabled = !hasNext;
        document.getElementById('restart-btn').disabled = !hasLesson;
        document.getElementById('finish-btn').disabled = !hasLesson;
      }

      // íŒì—… ì»¨íŠ¸ë¡¤ ì„¤ì •
      setupPopupControls() {
        const overlay = document.getElementById('popup-overlay');
        const closeBtn = document.getElementById('popup-close');
        
        // íŒì—… ë‹«ê¸°
        closeBtn.addEventListener('click', () => {
          this.closePopupPlayer();
        });

        // ë°°ê²½ í´ë¦­ìœ¼ë¡œ ë‹«ê¸°
        overlay.addEventListener('click', (e) => {
          if (e.target === overlay) {
            this.closePopupPlayer();
          }
        });

        // ESC í‚¤ë¡œ ë‹«ê¸°
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && overlay.classList.contains('active')) {
            this.closePopupPlayer();
          }
        });

        // íŒì—… í”Œë ˆì´ì–´ ì»¨íŠ¸ë¡¤
        document.getElementById('popup-prev-btn').addEventListener('click', () => {
          this.popupPreviousActivity();
        });
        
        document.getElementById('popup-next-btn').addEventListener('click', () => {
          this.popupNextActivity();
        });
        
        document.getElementById('popup-restart-btn').addEventListener('click', () => {
          this.popupRestartLesson();
        });
        
        document.getElementById('popup-finish-btn').addEventListener('click', () => {
          this.popupFinishLesson();
        });
      }

      // íŒì—… í”Œë ˆì´ì–´ ì—´ê¸°
      openPopupPlayer(lessonId) {
        try {
          const lesson = this.sampleLessons[lessonId];
          if (!lesson) {
            throw new Error('ë ˆìŠ¨ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          }

          // íŒì—…ìš© ìƒíƒœ ì´ˆê¸°í™”
          this.popupLesson = lesson;
          this.popupActivityIndex = 0;
          this.popupResults = [];

          // íŒì—… UI ì—…ë°ì´íŠ¸
          document.getElementById('popup-lesson-title').textContent = lesson.title;
          
          // íŒì—… í‘œì‹œ
          document.getElementById('popup-overlay').classList.add('active');
          
          // ì²« ë²ˆì§¸ í™œë™ ë¡œë“œ
          this.loadPopupActivity(0);
          this.updatePopupControls();
          
          this.showNotification('íŒì—… í”Œë ˆì´ì–´ì—ì„œ ë ˆìŠ¨ì„ ì‹œì‘í•©ë‹ˆë‹¤.', 'success');
          
        } catch (error) {
          console.error('íŒì—… í”Œë ˆì´ì–´ ì˜¤ë¥˜:', error);
          this.showNotification('íŒì—… í”Œë ˆì´ì–´ë¥¼ ì—´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + error.message, 'error');
        }
      }

      // íŒì—… í”Œë ˆì´ì–´ ë‹«ê¸°
      closePopupPlayer() {
        document.getElementById('popup-overlay').classList.remove('active');
        
        // ìƒíƒœ ì •ë¦¬
        this.popupLesson = null;
        this.popupActivityIndex = 0;
        this.popupResults = [];
        
        // íŒì—… ë‚´ìš© ì´ˆê¸°í™”
        document.getElementById('popup-activity-area').innerHTML = `
          <div class="activity-placeholder">
            <p>íŒì—… í”Œë ˆì´ì–´ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
            <p>ë ˆìŠ¨ì„ ì‹œì‘í•˜ë ¤ë©´ ì•„ë˜ ì»¨íŠ¸ë¡¤ì„ ì‚¬ìš©í•˜ì„¸ìš”.</p>
          </div>
        `;
      }

      // íŒì—… í™œë™ ë¡œë“œ
      loadPopupActivity(index) {
        if (!this.popupLesson || index < 0 || index >= this.popupLesson.activities.length) {
          return;
        }

        const activity = this.popupLesson.activities[index];
        const container = document.getElementById('popup-activity-area');
        
        // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
        const progress = ((index) / this.popupLesson.activities.length) * 100;
        document.getElementById('popup-progress-fill').style.width = `${progress}%`;

        try {
          // íŒì—… ì „ìš© ë Œë”ë§
          if (activity.type === 'video') {
            this.renderPopupVideoActivity(container, activity);
          } else if (activity.type === 'drag-drop') {
            this.renderPopupDragDropActivity(container, activity);
          } else {
            throw new Error(`ì§€ì›í•˜ì§€ ì•ŠëŠ” í™œë™ ìœ í˜•: ${activity.type}`);
          }
        } catch (error) {
          console.error('íŒì—… í™œë™ ë¡œë“œ ì‹¤íŒ¨:', error);
          container.innerHTML = `
            <div class="activity-placeholder">
              <p style="color: var(--danger);">í™œë™ì„ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤</p>
              <p>${error.message}</p>
            </div>
          `;
        }
      }

      // íŒì—…ìš© ë¹„ë””ì˜¤ í™œë™ ë Œë”ë§
      renderPopupVideoActivity(container, activity) {
        container.innerHTML = `
          <div style="width: 100%; text-align: center;">
            <h3 style="margin-bottom: 20px; color: var(--text-primary);">
              ${activity.title}
            </h3>
            <video controls style="width: 100%; max-width: 500px; max-height: 300px; border-radius: 8px; background: black;">
              <source src="${activity.content.src}" type="video/mp4">
              ì´ ë¸Œë¼ìš°ì €ëŠ” ë¹„ë””ì˜¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
            </video>
            <p style="margin-top: 16px; color: var(--text-secondary);">
              ${activity.content.description || 'ë¹„ë””ì˜¤ë¥¼ ì‹œì²­í•˜ê³  ë‹¤ìŒ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.'}
            </p>
          </div>
        `;
      }

      // íŒì—…ìš© ë“œë˜ê·¸ì•¤ë“œë¡­ í™œë™ ë Œë”ë§
      renderPopupDragDropActivity(container, activity) {
        const popupId = 'popup-' + Date.now(); // ê³ ìœ  ID ìƒì„±
        
        container.innerHTML = `
          <div style="width: 100%; max-width: 600px; text-align: center;">
            <h3 style="margin-bottom: 20px; color: var(--text-primary);">
              ${activity.title}
            </h3>
            <div style="font-size: 18px; margin-bottom: 20px; color: var(--text-primary);">
              ${activity.content.prompt}
            </div>
            <div class="drop-zone" id="popup-drop-zone-${popupId}" style="margin-bottom: 20px; min-height: 60px; display: flex; align-items: center; justify-content: center;">
              ì •ë‹µì„ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ì„¸ìš”
            </div>
            <div style="display: flex; flex-wrap: wrap; gap: 12px; justify-content: center;" id="popup-choices-${popupId}">
              ${activity.content.choices.map(choice => `
                <div class="choice-item" draggable="true" data-choice="${choice}" style="padding: 10px 16px; background: var(--primary); color: white; border-radius: 6px; cursor: pointer;">
                  ${choice}
                </div>
              `).join('')}
            </div>
          </div>
        `;

        // íŒì—…ìš© ë“œë˜ê·¸ì•¤ë“œë¡­ ì´ë²¤íŠ¸ ì„¤ì •
        this.setupPopupDragAndDrop(popupId, activity.content.answer);
      }

      // íŒì—…ìš© ë“œë˜ê·¸ì•¤ë“œë¡­ ì´ë²¤íŠ¸ ì„¤ì •
      setupPopupDragAndDrop(popupId, correctAnswer) {
        const dropZone = document.getElementById(`popup-drop-zone-${popupId}`);
        const choices = document.querySelectorAll(`#popup-choices-${popupId} .choice-item`);

        choices.forEach(choice => {
          choice.addEventListener('dragstart', (e) => {
            e.dataTransfer.setData('text/plain', e.target.dataset.choice);
          });
          
          // í´ë¦­ìœ¼ë¡œë„ ì„ íƒ ê°€ëŠ¥
          choice.addEventListener('click', (e) => {
            const selectedChoice = e.target.dataset.choice;
            this.handlePopupChoice(selectedChoice, correctAnswer, dropZone);
          });
        });

        dropZone.addEventListener('dragover', (e) => {
          e.preventDefault();
          dropZone.classList.add('drag-over');
        });

        dropZone.addEventListener('dragleave', () => {
          dropZone.classList.remove('drag-over');
        });

        dropZone.addEventListener('drop', (e) => {
          e.preventDefault();
          dropZone.classList.remove('drag-over');
          const selectedChoice = e.dataTransfer.getData('text/plain');
          this.handlePopupChoice(selectedChoice, correctAnswer, dropZone);
        });
      }

      // íŒì—… ì„ íƒ ì²˜ë¦¬
      handlePopupChoice(selectedChoice, correctAnswer, dropZone) {
        const isCorrect = selectedChoice === correctAnswer;
        
        dropZone.textContent = `ì„ íƒë¨: ${selectedChoice}`;
        dropZone.style.backgroundColor = isCorrect ? 'rgba(16, 185, 129, 0.2)' : 'rgba(239, 68, 68, 0.2)';
        dropZone.style.borderColor = isCorrect ? 'var(--secondary)' : 'var(--danger)';
        
        // ê²°ê³¼ ì €ì¥
        this.popupResults[this.popupActivityIndex] = {
          selected: selectedChoice,
          correct: correctAnswer,
          isCorrect: isCorrect,
          timestamp: Date.now()
        };

        if (isCorrect) {
          setTimeout(() => {
            this.showNotification('ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰', 'success');
          }, 500);
        } else {
          setTimeout(() => {
            this.showNotification('ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”. ğŸ¤”', 'error');
          }, 500);
        }
      }

      // íŒì—… í”Œë ˆì´ì–´ ë„¤ë¹„ê²Œì´ì…˜ ë©”ì†Œë“œë“¤
      popupPreviousActivity() {
        if (this.popupActivityIndex > 0) {
          this.popupActivityIndex--;
          this.loadPopupActivity(this.popupActivityIndex);
          this.updatePopupControls();
        }
      }

      popupNextActivity() {
        if (this.popupActivityIndex < this.popupLesson.activities.length - 1) {
          this.popupActivityIndex++;
          this.loadPopupActivity(this.popupActivityIndex);
          this.updatePopupControls();
        } else {
          this.popupFinishLesson();
        }
      }

      popupRestartLesson() {
        if (confirm('ë ˆìŠ¨ì„ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          this.popupActivityIndex = 0;
          this.popupResults = [];
          this.loadPopupActivity(0);
          this.updatePopupControls();
          this.showNotification('íŒì—… ë ˆìŠ¨ì´ ì¬ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        }
      }

      popupFinishLesson() {
        const correctAnswers = this.popupResults.filter(r => r && r.isCorrect).length;
        const totalAnswers = this.popupResults.filter(r => r).length;
        const percentage = totalAnswers > 0 ? Math.round((correctAnswers / totalAnswers) * 100) : 0;

        setTimeout(() => {
          alert(`ğŸ‰ íŒì—… ë ˆìŠ¨ ì™„ë£Œ!
        
ğŸ“Š ê²°ê³¼:
ì •ë‹µë¥ : ${percentage}% (${correctAnswers}/${totalAnswers})

ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤! ğŸ‘`);

          this.closePopupPlayer();
        }, 100);
      }

      // íŒì—… ì»¨íŠ¸ë¡¤ ìƒíƒœ ì—…ë°ì´íŠ¸
      updatePopupControls() {
        if (!this.popupLesson) return;

        const hasPrevious = this.popupActivityIndex > 0;
        const hasNext = this.popupActivityIndex < this.popupLesson.activities.length - 1;

        document.getElementById('popup-prev-btn').disabled = !hasPrevious;
        document.getElementById('popup-next-btn').disabled = !hasNext;
        document.getElementById('popup-restart-btn').disabled = false;
        document.getElementById('popup-finish-btn').disabled = false;
      }

      // ì•Œë¦¼ í‘œì‹œ
      showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.textContent = message;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
          if (notification.parentElement) {
            notification.remove();
          }
        }, 3000);
      }
    }

    // ì•± ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', () => {
      window.lessonPlatform = new SafeLessonPlatform();
    });
  </script>
</body>
</html>