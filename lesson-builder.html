<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ğŸ“š ë ˆìŠ¨ ë¹Œë”</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #1e1e2e;
            color: #cdd6f4;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: #313244;
            padding: 1rem 2rem;
            border-bottom: 1px solid #45475a;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            color: #cba6f7;
            font-size: 1.5rem;
        }
        
        .header-actions {
            display: flex;
            gap: 1rem;
        }
        
        .container {
            display: flex;
            flex: 1;
            min-height: 0;
        }
        
        .sidebar {
            width: 320px;
            background: #313244;
            border-right: 1px solid #45475a;
            display: flex;
            flex-direction: column;
        }
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .toolbar {
            background: #45475a;
            padding: 1rem 2rem;
            border-bottom: 1px solid #6c7086;
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .workspace {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }
        
        .card {
            background: #45475a;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid #6c7086;
        }
        
        .card-title {
            color: #fab387;
            font-weight: 600;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-label {
            display: block;
            color: #a6adc8;
            font-weight: 500;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        
        .form-input {
            width: 100%;
            background: #313244;
            border: 1px solid #6c7086;
            border-radius: 6px;
            padding: 0.75rem;
            color: #cdd6f4;
            font-size: 0.95rem;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #89b4fa;
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-select {
            width: 100%;
            background: #313244;
            border: 1px solid #6c7086;
            border-radius: 6px;
            padding: 0.75rem;
            color: #cdd6f4;
            cursor: pointer;
        }
        
        .btn {
            background: #89b4fa;
            color: #1e1e2e;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            font-size: 0.9rem;
        }
        
        .btn:hover {
            background: #74c7ec;
            transform: translateY(-1px);
        }
        
        .btn:disabled {
            background: #6c7086;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-success {
            background: #a6e3a1;
        }
        
        .btn-success:hover {
            background: #94e2d5;
        }
        
        .btn-danger {
            background: #f38ba8;
        }
        
        .btn-danger:hover {
            background: #eba0ac;
        }
        
        .btn-secondary {
            background: #6c7086;
        }
        
        .btn-secondary:hover {
            background: #585b70;
        }
        
        .activity-list {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }
        
        .activity-item {
            background: #585b70;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        
        .activity-item:hover {
            background: #6c7086;
        }
        
        .activity-item.selected {
            border-color: #89b4fa;
            background: rgba(137, 180, 250, 0.1);
        }
        
        .activity-type {
            color: #fab387;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .activity-title {
            font-weight: 600;
            margin: 0.5rem 0;
        }
        
        .activity-description {
            color: #a6adc8;
            font-size: 0.9rem;
        }
        
        .template-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .template-card {
            background: #313244;
            border: 2px solid #6c7086;
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .template-card:hover {
            border-color: #89b4fa;
            background: #45475a;
        }
        
        .template-card.selected {
            border-color: #a6e3a1;
            background: rgba(166, 227, 161, 0.1);
        }
        
        .template-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .template-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .template-desc {
            color: #a6adc8;
            font-size: 0.8rem;
        }
        
        .choice-builder {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .choice-item {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        .choice-input {
            flex: 1;
        }
        
        .choice-correct {
            width: 20px;
            height: 20px;
        }
        
        .json-preview {
            background: #1e1e2e;
            border: 1px solid #45475a;
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            color: #cdd6f4;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #89b4fa;
            color: #1e1e2e;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: #a6e3a1;
        }
        
        .notification.error {
            background: #f38ba8;
        }
        
        .notification.warning {
            background: #fab387;
        }
        
        .tabs {
            display: flex;
            background: #313244;
            border-bottom: 1px solid #45475a;
        }
        
        .tab {
            padding: 1rem 1.5rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .tab:hover {
            background: #45475a;
        }
        
        .tab.active {
            border-bottom-color: #89b4fa;
            color: #89b4fa;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #6c7086;
        }
        
        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        /* ìˆ¨ê¹€ ìš”ì†Œ */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“š ë ˆìŠ¨ ë¹Œë”</h1>
        <div class="header-actions">
            <button class="btn btn-success" id="save-lesson-btn" disabled>ğŸ’¾ ë ˆìŠ¨ ì €ì¥</button>
            <button class="btn" id="preview-lesson-btn" disabled>ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°</button>
            <button class="btn btn-secondary" id="export-json-btn" disabled>ğŸ“¤ JSON ë‚´ë³´ë‚´ê¸°</button>
        </div>
    </div>
    
    <div class="container">
        <div class="sidebar">
            <!-- ë ˆìŠ¨ ì •ë³´ -->
            <div class="card" style="margin-bottom: 0;">
                <div class="card-title">ë ˆìŠ¨ ì •ë³´</div>
                
                <div class="form-group">
                    <label class="form-label">ë ˆìŠ¨ ì œëª©</label>
                    <input type="text" class="form-input" id="lesson-title" placeholder="ë ˆìŠ¨ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                
                <div class="form-group">
                    <label class="form-label">ì„¤ëª…</label>
                    <textarea class="form-input form-textarea" id="lesson-description" placeholder="ë ˆìŠ¨ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">ë‚œì´ë„</label>
                    <select class="form-select" id="lesson-difficulty">
                        <option value="beginner">ì´ˆê¸‰</option>
                        <option value="intermediate">ì¤‘ê¸‰</option>
                        <option value="advanced">ê³ ê¸‰</option>
                        <option value="mixed">í˜¼í•©</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">ì˜ˆìƒ ì‹œê°„ (ë¶„)</label>
                    <input type="number" class="form-input" id="lesson-time" placeholder="15" min="1" max="120">
                </div>
            </div>
            
            <!-- í™œë™ ëª©ë¡ -->
            <div style="border-top: 1px solid #45475a; padding-top: 1rem;">
                <div style="padding: 0 1.5rem; margin-bottom: 1rem; display: flex; justify-content: between; align-items: center;">
                    <div class="card-title" style="margin: 0;">í™œë™ ëª©ë¡</div>
                    <button class="btn" id="add-activity-btn">â• í™œë™ ì¶”ê°€</button>
                </div>
                
                <div class="activity-list" id="activity-list">
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“</div>
                        <p>í™œë™ì„ ì¶”ê°€í•´ë³´ì„¸ìš”</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="toolbar">
                <select class="form-select" id="template-select" style="width: 250px;">
                    <option value="">í…œí”Œë¦¿ì„ ì„ íƒí•˜ì„¸ìš”</option>
                    <optgroup label="ë‚´ì¥ í…œí”Œë¦¿">
                        <option value="multiple-choice">ğŸ”˜ 4ì§€ ì„ ë‹¤í˜•</option>
                        <option value="word-guess">ğŸ”¤ ë‹¨ì–´ ë§ì¶”ê¸°</option>
                        <option value="memory-game">ğŸ§  ë©”ëª¨ë¦¬ ê²Œì„</option>
                        <option value="video">ğŸ¥ ë¹„ë””ì˜¤</option>
                        <option value="quiz">â“ í€´ì¦ˆ</option>
                        <option value="survey">ğŸ“‹ ì„¤ë¬¸ì¡°ì‚¬</option>
                    </optgroup>
                    <optgroup label="ì™¸ë¶€ í”ŒëŸ¬ê·¸ì¸">
                        <option value="fill-in-blanks">âœï¸ ë¹ˆì¹¸ ì±„ìš°ê¸°</option>
                        <option value="chinese-pinyin-match">ğŸ€„ ì¤‘êµ­ì–´ ë³‘ìŒ ë§¤ì¹­</option>
                    </optgroup>
                </select>
                
                <button class="btn" id="create-activity-btn" disabled>í™œë™ ìƒì„±</button>
                
                <div style="flex: 1;"></div>
                
                <button class="btn btn-secondary" id="delete-activity-btn" disabled>ğŸ—‘ï¸ ì‚­ì œ</button>
            </div>
            
            <div class="workspace" id="workspace">
                <!-- ê¸°ë³¸ ìƒíƒœ -->
                <div id="welcome-state">
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸš€</div>
                        <h2>ë ˆìŠ¨ ë¹Œë”ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!</h2>
                        <p>ì¢Œì¸¡ì—ì„œ ë ˆìŠ¨ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  í™œë™ì„ ì¶”ê°€í•´ë³´ì„¸ìš”.</p>
                    </div>
                </div>
                
                <!-- í™œë™ í¸ì§‘ê¸° -->
                <div id="activity-editor" class="hidden">
                    <div class="tabs">
                        <div class="tab active" data-tab="edit">âœï¸ í¸ì§‘</div>
                        <div class="tab" data-tab="preview">ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°</div>
                        <div class="tab" data-tab="json">ğŸ”§ JSON</div>
                    </div>
                    
                    <div class="tab-content active" id="edit-tab">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  í¸ì§‘ í¼ -->
                    </div>
                    
                    <div class="tab-content" id="preview-tab">
                        <!-- í™œë™ ë¯¸ë¦¬ë³´ê¸° -->
                    </div>
                    
                    <div class="tab-content" id="json-tab">
                        <div class="card">
                            <div class="card-title">JSON ë¯¸ë¦¬ë³´ê¸°</div>
                            <div class="json-preview" id="json-preview"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ì „ì—­ ìƒíƒœ
        let currentLesson = {
            lessonId: '',
            title: '',
            description: '',
            locale: 'ko',
            version: '1.0.0',
            flow: [],
            grading: {
                mode: 'weighted-sum',
                passLine: 0.7,
                showScores: true,
                showProgress: true
            },
            metadata: {
                author: 'Lesson Builder',
                createdAt: new Date().toISOString(),
                tags: [],
                difficulty: 'intermediate',
                estimatedTime: 15
            }
        };
        
        let selectedActivityIndex = -1;
        let activities = [];
        
        // DOM ìš”ì†Œë“¤
        const lessonTitle = document.getElementById('lesson-title');
        const lessonDescription = document.getElementById('lesson-description');
        const lessonDifficulty = document.getElementById('lesson-difficulty');
        const lessonTime = document.getElementById('lesson-time');
        const activityList = document.getElementById('activity-list');
        const addActivityBtn = document.getElementById('add-activity-btn');
        const templateSelect = document.getElementById('template-select');
        const createActivityBtn = document.getElementById('create-activity-btn');
        const deleteActivityBtn = document.getElementById('delete-activity-btn');
        const saveLessonBtn = document.getElementById('save-lesson-btn');
        const previewLessonBtn = document.getElementById('preview-lesson-btn');
        const exportJsonBtn = document.getElementById('export-json-btn');
        const workspace = document.getElementById('workspace');
        const welcomeState = document.getElementById('welcome-state');
        const activityEditor = document.getElementById('activity-editor');
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        lessonTitle.addEventListener('input', updateLessonInfo);
        lessonDescription.addEventListener('input', updateLessonInfo);
        lessonDifficulty.addEventListener('change', updateLessonInfo);
        lessonTime.addEventListener('input', updateLessonInfo);
        
        addActivityBtn.addEventListener('click', showTemplateSelector);
        templateSelect.addEventListener('change', function() {
            createActivityBtn.disabled = !templateSelect.value;
        });
        createActivityBtn.addEventListener('click', createNewActivity);
        deleteActivityBtn.addEventListener('click', deleteActivity);
        
        saveLessonBtn.addEventListener('click', saveLesson);
        previewLessonBtn.addEventListener('click', previewLesson);
        exportJsonBtn.addEventListener('click', exportJson);
        
        // íƒ­ ì „í™˜
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('tab')) {
                switchTab(e.target.dataset.tab);
            }
        });
        
        // ë ˆìŠ¨ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateLessonInfo() {
            currentLesson.title = lessonTitle.value;
            currentLesson.description = lessonDescription.value;
            currentLesson.metadata.difficulty = lessonDifficulty.value;
            currentLesson.metadata.estimatedTime = parseInt(lessonTime.value) || 15;
            currentLesson.lessonId = generateLessonId(lessonTitle.value);
            
            updateButtonStates();
        }
        
        // ë ˆìŠ¨ ID ìƒì„±
        function generateLessonId(title) {
            return title.toLowerCase()
                .replace(/[^a-z0-9ê°€-í£\s]/g, '')
                .replace(/\s+/g, '-')
                .substring(0, 50) + '-' + Date.now().toString(36);
        }
        
        // í…œí”Œë¦¿ ì„ íƒê¸° í‘œì‹œ
        function showTemplateSelector() {
            // í…œí”Œë¦¿ ì„ íƒ ëª¨ë‹¬ì´ë‚˜ ì‚¬ì´ë“œë°” í‘œì‹œ
            templateSelect.focus();
            showNotification('í…œí”Œë¦¿ì„ ì„ íƒí•˜ê³  "í™œë™ ìƒì„±" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”', 'info');
        }
        
        // ìƒˆ í™œë™ ìƒì„±
        function createNewActivity() {
            const templateType = templateSelect.value;
            if (!templateType) return;
            
            const newActivity = createActivityTemplate(templateType);
            activities.push(newActivity);
            currentLesson.flow.push(newActivity);
            
            renderActivityList();
            selectActivity(activities.length - 1);
            
            templateSelect.value = '';
            createActivityBtn.disabled = true;
            
            showNotification('ìƒˆ í™œë™ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }
        
        // í™œë™ í…œí”Œë¦¿ ìƒì„±
        function createActivityTemplate(type) {
            const activityId = `activity-${Date.now()}`;
            
            const baseActivity = {
                activityId: activityId,
                template: `${type}@1.0.0`,
                rules: {
                    scoreWeight: 1,
                    required: true
                }
            };
            
            switch (type) {
                case 'multiple-choice':
                    return {
                        ...baseActivity,
                        params: {
                            question: 'ìƒˆë¡œìš´ ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”',
                            choices: [
                                { id: 'choice-a', text: 'ì„ íƒì§€ 1' },
                                { id: 'choice-b', text: 'ì„ íƒì§€ 2' },
                                { id: 'choice-c', text: 'ì„ íƒì§€ 3' },
                                { id: 'choice-d', text: 'ì„ íƒì§€ 4' }
                            ],
                            correctAnswer: 'choice-a',
                            allowMultiple: false,
                            shuffle: true,
                            timeLimit: 30,
                            explanation: 'ì •ë‹µì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”',
                            showFeedback: true,
                            hints: []
                        }
                    };
                    
                case 'word-guess':
                    return {
                        ...baseActivity,
                        params: {
                            word: 'ë‹¨ì–´',
                            hint: 'íŒíŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”',
                            category: 'ì¹´í…Œê³ ë¦¬',
                            maxAttempts: 6,
                            showHintAfter: 3,
                            timeLimit: 120,
                            difficulty: 'ë³´í†µ'
                        }
                    };
                    
                case 'memory-game':
                    return {
                        ...baseActivity,
                        params: {
                            title: 'ë©”ëª¨ë¦¬ ê²Œì„',
                            cards: [
                                { id: 'card-1', content: 'ì¹´ë“œ 1', type: 'text', matchId: 'pair1' },
                                { id: 'card-2', content: 'ì¹´ë“œ 1 ë§¤ì¹˜', type: 'text', matchId: 'pair1' },
                                { id: 'card-3', content: 'ì¹´ë“œ 2', type: 'text', matchId: 'pair2' },
                                { id: 'card-4', content: 'ì¹´ë“œ 2 ë§¤ì¹˜', type: 'text', matchId: 'pair2' }
                            ],
                            gridSize: '2x2',
                            timeLimit: 120,
                            allowRetries: true,
                            maxAttempts: 5,
                            showTimer: true,
                            successMessage: 'ì¶•í•˜í•©ë‹ˆë‹¤!',
                            failureMessage: 'ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”',
                            hints: [],
                            shuffle: true
                        }
                    };
                    
                case 'video':
                    return {
                        ...baseActivity,
                        params: {
                            title: 'ë¹„ë””ì˜¤ í™œë™',
                            src: '',
                            description: 'ë¹„ë””ì˜¤ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”',
                            autoplay: false,
                            controls: true
                        }
                    };
                    
                case 'quiz':
                    return {
                        ...baseActivity,
                        params: {
                            question: 'í€´ì¦ˆ ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”',
                            choices: ['ì„ íƒì§€ 1', 'ì„ íƒì§€ 2', 'ì„ íƒì§€ 3', 'ì„ íƒì§€ 4'],
                            correct: 'ì„ íƒì§€ 1'
                        }
                    };
                    
                case 'fill-in-blanks':
                    return {
                        ...baseActivity,
                        template: 'fill-in-blanks@1.0.0',
                        params: {
                            title: 'ë¹ˆì¹¸ ì±„ìš°ê¸°',
                            sentence: 'ê³ ì–‘ì´ê°€ {blank}ë¥¼ ì«“ì•„ê°„ë‹¤.',
                            blanks: [
                                { id: 'blank-1', position: '{blank}', answer: 'ì¥', alternatives: ['ì¥', 'ìƒì¥'] }
                            ],
                            caseSensitive: false,
                            showHints: true,
                            hints: ['ì‘ì€ ë™ë¬¼', 'ì¹˜ì¦ˆë¥¼ ì¢‹ì•„í•¨'],
                            timeLimit: 0,
                            feedback: {
                                correct: 'ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰',
                                incorrect: 'ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”. ğŸ’­',
                                timeout: 'ì‹œê°„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! â°',
                                complete: 'ëª¨ë“  ë¹ˆì¹¸ì„ ì™„ì„±í–ˆìŠµë‹ˆë‹¤! ğŸŒŸ'
                            },
                            allowMultipleAttempts: true,
                            showProgressBar: true,
                            autoCheckOnComplete: false
                        }
                    };
                    
                case 'chinese-pinyin-match':
                    return {
                        ...baseActivity,
                        template: 'chinese-pinyin-match@1.0.0',
                        params: {
                            words: [
                                { hanzi: 'ä½ å¥½', pinyin: 'nÇhÇo', meaning: 'ì•ˆë…•í•˜ì„¸ìš”' },
                                { hanzi: 'è°¢è°¢', pinyin: 'xiÃ¨xie', meaning: 'ê°ì‚¬í•©ë‹ˆë‹¤' },
                                { hanzi: 'å†è§', pinyin: 'zÃ ijiÃ n', meaning: 'ì•ˆë…•íˆ ê°€ì„¸ìš”' },
                                { hanzi: 'æ—©ä¸Šå¥½', pinyin: 'zÇoshang hÇo', meaning: 'ì¢‹ì€ ì•„ì¹¨ì…ë‹ˆë‹¤' },
                                { hanzi: 'æ™šå®‰', pinyin: 'wÇn\'Än', meaning: 'ì•ˆë…•íˆ ì£¼ë¬´ì„¸ìš”' },
                                { hanzi: 'å¯¹ä¸èµ·', pinyin: 'duÃ¬bÃ¹qÇ', meaning: 'ì£„ì†¡í•©ë‹ˆë‹¤' }
                            ],
                            showHint: true,
                            autoShuffle: true,
                            successMessage: 'ì¶•í•˜í•©ë‹ˆë‹¤! ëª¨ë“  ë§¤ì¹­ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤! ğŸ‰',
                            failMessage: 'ì•„ì§ ë§¤ì¹­ë˜ì§€ ì•Šì€ í•­ëª©ì´ ìˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”!'
                        }
                    };
                    
                case 'survey':
                    return {
                        ...baseActivity,
                        params: {
                            questions: [
                                {
                                    type: 'multiple-choice',
                                    question: 'ìƒ˜í”Œ ê°ê´€ì‹ ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”',
                                    options: ['ì˜µì…˜ 1', 'ì˜µì…˜ 2', 'ì˜µì…˜ 3'],
                                    required: true
                                },
                                {
                                    type: 'rating',
                                    question: 'í‰ì ì„ ë§¤ê²¨ì£¼ì„¸ìš”',
                                    scale: 5,
                                    scaleLabels: ['ë§¤ìš° ë‚˜ì¨', 'ë§¤ìš° ì¢‹ìŒ'],
                                    required: true
                                },
                                {
                                    type: 'text',
                                    question: 'ììœ ë¡­ê²Œ ì˜ê²¬ì„ ì‘ì„±í•´ì£¼ì„¸ìš”',
                                    required: false
                                }
                            ]
                        }
                    };
                    
                default:
                    return baseActivity;
            }
        }
        
        // í™œë™ ëª©ë¡ ë Œë”ë§
        function renderActivityList() {
            if (activities.length === 0) {
                activityList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“</div>
                        <p>í™œë™ì„ ì¶”ê°€í•´ë³´ì„¸ìš”</p>
                    </div>
                `;
                return;
            }
            
            activityList.innerHTML = activities.map((activity, index) => {
                const templateType = activity.template.split('@')[0];
                const typeLabels = {
                    'multiple-choice': '4ì§€ ì„ ë‹¤í˜•',
                    'word-guess': 'ë‹¨ì–´ ë§ì¶”ê¸°',
                    'memory-game': 'ë©”ëª¨ë¦¬ ê²Œì„',
                    'video': 'ë¹„ë””ì˜¤',
                    'quiz': 'í€´ì¦ˆ',
                    'survey': 'ì„¤ë¬¸ì¡°ì‚¬'
                };
                
                return `
                    <div class="activity-item ${index === selectedActivityIndex ? 'selected' : ''}" 
                         onclick="selectActivity(${index})">
                        <div class="activity-type">${typeLabels[templateType] || templateType}</div>
                        <div class="activity-title">${activity.params.question || activity.params.title || activity.activityId}</div>
                        <div class="activity-description">í™œë™ ${index + 1}</div>
                    </div>
                `;
            }).join('');
        }
        
        // í™œë™ ì„ íƒ
        function selectActivity(index) {
            selectedActivityIndex = index;
            renderActivityList();
            
            if (index >= 0 && index < activities.length) {
                showActivityEditor(activities[index]);
                deleteActivityBtn.disabled = false;
            } else {
                hideActivityEditor();
                deleteActivityBtn.disabled = true;
            }
        }
        
        // í™œë™ í¸ì§‘ê¸° í‘œì‹œ
        function showActivityEditor(activity) {
            welcomeState.classList.add('hidden');
            activityEditor.classList.remove('hidden');
            
            renderActivityEditor(activity);
        }
        
        // í™œë™ í¸ì§‘ê¸° ìˆ¨ê¹€
        function hideActivityEditor() {
            welcomeState.classList.remove('hidden');
            activityEditor.classList.add('hidden');
        }
        
        // í™œë™ í¸ì§‘ê¸° ë Œë”ë§
        function renderActivityEditor(activity) {
            const editTab = document.getElementById('edit-tab');
            const templateType = activity.template.split('@')[0];
            
            let editorHtml = '';
            
            switch (templateType) {
                case 'multiple-choice':
                    editorHtml = renderMultipleChoiceEditor(activity);
                    break;
                case 'word-guess':
                    editorHtml = renderWordGuessEditor(activity);
                    break;
                case 'memory-game':
                    editorHtml = renderMemoryGameEditor(activity);
                    break;
                case 'video':
                    editorHtml = renderVideoEditor(activity);
                    break;
                case 'quiz':
                    editorHtml = renderQuizEditor(activity);
                    break;
                case 'survey':
                    editorHtml = renderSurveyEditor(activity);
                    break;
                case 'fill-in-blanks':
                    editorHtml = renderExternalPluginEditor(activity, 'âœï¸ ë¹ˆì¹¸ ì±„ìš°ê¸° í”ŒëŸ¬ê·¸ì¸');
                    break;
                case 'chinese-pinyin-match':
                    editorHtml = renderExternalPluginEditor(activity, 'ğŸ€„ ì¤‘êµ­ì–´ ë³‘ìŒ ë§¤ì¹­ í”ŒëŸ¬ê·¸ì¸');
                    break;
                default:
                    editorHtml = '<div class="card"><div class="card-title">ì§€ì›í•˜ì§€ ì•ŠëŠ” í…œí”Œë¦¿</div></div>';
            }
            
            editTab.innerHTML = editorHtml;
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²°
            attachEditorEvents();
            updateJsonPreview();
        }
        
        // 4ì§€ ì„ ë‹¤í˜• í¸ì§‘ê¸°
        function renderMultipleChoiceEditor(activity) {
            const params = activity.params;
            
            return `
                <div class="card">
                    <div class="card-title">ğŸ”˜ 4ì§€ ì„ ë‹¤í˜• ë¬¸ì œ í¸ì§‘</div>
                    
                    <div class="form-group">
                        <label class="form-label">ì§ˆë¬¸</label>
                        <textarea class="form-input form-textarea" id="question" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”">${params.question}</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ì„ íƒì§€</label>
                        <div class="choice-builder" id="choice-builder">
                            ${params.choices.map((choice, index) => `
                                <div class="choice-item">
                                    <input type="text" class="form-input choice-input" 
                                           value="${choice.text}" 
                                           data-choice-id="${choice.id}"
                                           placeholder="ì„ íƒì§€ ${index + 1}">
                                    <input type="checkbox" class="choice-correct" 
                                           ${(Array.isArray(params.correctAnswer) ? params.correctAnswer.includes(choice.id) : params.correctAnswer === choice.id) ? 'checked' : ''}
                                           data-choice-id="${choice.id}">
                                    <button class="btn btn-danger" onclick="removeChoice('${choice.id}')">ğŸ—‘ï¸</button>
                                </div>
                            `).join('')}
                        </div>
                        <button class="btn" onclick="addChoice()">â• ì„ íƒì§€ ì¶”ê°€</button>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="allow-multiple" ${params.allowMultiple ? 'checked' : ''}>
                            ë‹¤ì¤‘ ì„ íƒ í—ˆìš©
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ì‹œê°„ ì œí•œ (ì´ˆ)</label>
                        <input type="number" class="form-input" id="time-limit" value="${params.timeLimit}" min="10" max="300">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ì„¤ëª…</label>
                        <textarea class="form-input form-textarea" id="explanation" placeholder="ì •ë‹µ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">${params.explanation}</textarea>
                    </div>
                </div>
            `;
        }
        
        // ë‹¨ì–´ ë§ì¶”ê¸° í¸ì§‘ê¸°
        function renderWordGuessEditor(activity) {
            const params = activity.params;
            
            return `
                <div class="card">
                    <div class="card-title">ğŸ”¤ ë‹¨ì–´ ë§ì¶”ê¸° í¸ì§‘</div>
                    
                    <div class="form-group">
                        <label class="form-label">ì •ë‹µ ë‹¨ì–´</label>
                        <input type="text" class="form-input" id="word" value="${params.word}" placeholder="ì •ë‹µ ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">íŒíŠ¸</label>
                        <textarea class="form-input form-textarea" id="hint" placeholder="íŒíŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">${params.hint}</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ì¹´í…Œê³ ë¦¬</label>
                        <input type="text" class="form-input" id="category" value="${params.category}" placeholder="ì¹´í…Œê³ ë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ìµœëŒ€ ì‹œë„ íšŸìˆ˜</label>
                        <input type="number" class="form-input" id="max-attempts" value="${params.maxAttempts}" min="3" max="10">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ì‹œê°„ ì œí•œ (ì´ˆ)</label>
                        <input type="number" class="form-input" id="time-limit" value="${params.timeLimit}" min="30" max="300">
                    </div>
                </div>
            `;
        }
        
        // ë©”ëª¨ë¦¬ ê²Œì„ í¸ì§‘ê¸°
        function renderMemoryGameEditor(activity) {
            const params = activity.params;
            
            return `
                <div class="card">
                    <div class="card-title">ğŸ§  ë©”ëª¨ë¦¬ ê²Œì„ í¸ì§‘</div>
                    
                    <div class="form-group">
                        <label class="form-label">ê²Œì„ ì œëª©</label>
                        <input type="text" class="form-input" id="game-title" value="${params.title}" placeholder="ê²Œì„ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ì¹´ë“œ ìŒ</label>
                        <div id="card-builder">
                            ${renderCardPairs(params.cards)}
                        </div>
                        <button class="btn" onclick="addCardPair()">â• ì¹´ë“œ ìŒ ì¶”ê°€</button>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ì‹œê°„ ì œí•œ (ì´ˆ)</label>
                        <input type="number" class="form-input" id="time-limit" value="${params.timeLimit}" min="30" max="600">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ì„±ê³µ ë©”ì‹œì§€</label>
                        <input type="text" class="form-input" id="success-message" value="${params.successMessage}">
                    </div>
                </div>
            `;
        }
        
        // ì¹´ë“œ ìŒ ë Œë”ë§
        function renderCardPairs(cards) {
            const pairs = [];
            const processedMatchIds = new Set();
            
            cards.forEach(card => {
                if (!processedMatchIds.has(card.matchId)) {
                    const matchingCards = cards.filter(c => c.matchId === card.matchId);
                    if (matchingCards.length === 2) {
                        pairs.push(matchingCards);
                        processedMatchIds.add(card.matchId);
                    }
                }
            });
            
            return pairs.map((pair, index) => `
                <div class="card" style="margin-bottom: 1rem; background: #313244;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <span>ì¹´ë“œ ìŒ ${index + 1}</span>
                        <button class="btn btn-danger" onclick="removeCardPair('${pair[0].matchId}')">ğŸ—‘ï¸ ì‚­ì œ</button>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <label class="form-label">ì¹´ë“œ A</label>
                            <input type="text" class="form-input" value="${pair[0].content}" 
                                   data-match-id="${pair[0].matchId}" data-card-index="0">
                        </div>
                        <div>
                            <label class="form-label">ì¹´ë“œ B</label>
                            <input type="text" class="form-input" value="${pair[1].content}" 
                                   data-match-id="${pair[0].matchId}" data-card-index="1">
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // ë¹„ë””ì˜¤ í¸ì§‘ê¸°
        function renderVideoEditor(activity) {
            const params = activity.params;
            
            return `
                <div class="card">
                    <div class="card-title">ğŸ¥ ë¹„ë””ì˜¤ í™œë™ í¸ì§‘</div>
                    
                    <div class="form-group">
                        <label class="form-label">ì œëª©</label>
                        <input type="text" class="form-input" id="video-title" value="${params.title}" placeholder="ë¹„ë””ì˜¤ ì œëª©">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ë¹„ë””ì˜¤ URL</label>
                        <input type="url" class="form-input" id="video-src" value="${params.src}" placeholder="https://example.com/video.mp4">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ì„¤ëª…</label>
                        <textarea class="form-input form-textarea" id="video-description" placeholder="ë¹„ë””ì˜¤ ì„¤ëª…">${params.description}</textarea>
                    </div>
                </div>
            `;
        }
        
        // í€´ì¦ˆ í¸ì§‘ê¸°
        function renderQuizEditor(activity) {
            const params = activity.params;
            
            return `
                <div class="card">
                    <div class="card-title">â“ í€´ì¦ˆ í¸ì§‘</div>
                    
                    <div class="form-group">
                        <label class="form-label">ì§ˆë¬¸</label>
                        <textarea class="form-input form-textarea" id="question" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”">${params.question}</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ì„ íƒì§€</label>
                        ${params.choices.map((choice, index) => `
                            <input type="text" class="form-input" style="margin-bottom: 0.5rem;" 
                                   value="${choice}" data-choice-index="${index}" placeholder="ì„ íƒì§€ ${index + 1}">
                        `).join('')}
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ì •ë‹µ</label>
                        <input type="text" class="form-input" id="correct-answer" value="${params.correct}" placeholder="ì •ë‹µ">
                    </div>
                </div>
            `;
        }
        
        // Survey í¸ì§‘ê¸° - ìƒˆë¡œìš´ í…œí”Œë¦¿!
        function renderSurveyEditor(activity) {
            const params = activity.params;
            
            return `
                <div class="card">
                    <div class="card-title">ğŸ“‹ ì„¤ë¬¸ì¡°ì‚¬ í¸ì§‘</div>
                    
                    <div class="form-group">
                        <label class="form-label">ì§ˆë¬¸ ëª©ë¡</label>
                        <div id="survey-questions">
                            ${params.questions.map((question, index) => `
                                <div class="card" style="margin-bottom: 1rem; background: #313244;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                        <span>ì§ˆë¬¸ ${index + 1}</span>
                                        <button class="btn btn-danger" onclick="removeSurveyQuestion(${index})">ğŸ—‘ï¸ ì‚­ì œ</button>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">ì§ˆë¬¸ ìœ í˜•</label>
                                        <select class="form-select" data-question-index="${index}" onchange="updateQuestionType(${index}, this.value)">
                                            <option value="multiple-choice" ${question.type === 'multiple-choice' ? 'selected' : ''}>ê°ê´€ì‹</option>
                                            <option value="rating" ${question.type === 'rating' ? 'selected' : ''}>í‰ì </option>
                                            <option value="text" ${question.type === 'text' ? 'selected' : ''}>ì£¼ê´€ì‹</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">ì§ˆë¬¸</label>
                                        <textarea class="form-input" data-question-index="${index}" 
                                                 placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”">${question.question}</textarea>
                                    </div>
                                    
                                    ${question.type === 'multiple-choice' ? `
                                        <div class="form-group">
                                            <label class="form-label">ì„ íƒì§€</label>
                                            ${question.options.map((option, oIndex) => `
                                                <input type="text" class="form-input" style="margin-bottom: 0.5rem;" 
                                                       value="${option}" 
                                                       data-question-index="${index}" 
                                                       data-option-index="${oIndex}" 
                                                       placeholder="ì„ íƒì§€ ${oIndex + 1}">
                                            `).join('')}
                                            <button class="btn" onclick="addSurveyOption(${index})">â• ì„ íƒì§€ ì¶”ê°€</button>
                                        </div>
                                    ` : ''}
                                    
                                    ${question.type === 'rating' ? `
                                        <div class="form-group">
                                            <label class="form-label">í‰ì  ë²”ìœ„ (1-10)</label>
                                            <input type="number" class="form-input" 
                                                   value="${question.scale || 5}" 
                                                   data-question-index="${index}"
                                                   data-field="scale" min="3" max="10">
                                        </div>
                                    ` : ''}
                                    
                                    <div class="form-group">
                                        <label class="form-label">
                                            <input type="checkbox" ${question.required ? 'checked' : ''} 
                                                   data-question-index="${index}" data-field="required">
                                            í•„ìˆ˜ ì§ˆë¬¸
                                        </label>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <button class="btn" onclick="addSurveyQuestion()">â• ì§ˆë¬¸ ì¶”ê°€</button>
                    </div>
                </div>
            `;
        }
        
        // ì™¸ë¶€ í”ŒëŸ¬ê·¸ì¸ ì—ë””í„° (JSON ê¸°ë°˜)
        function renderExternalPluginEditor(activity, title) {
            return `
                <div class="card">
                    <div class="card-title">${title}</div>
                    
                    <div class="form-group">
                        <label class="form-label">íŒŒë¼ë¯¸í„° (JSON)</label>
                        <p style="color: #a6adc8; font-size: 0.9rem; margin-bottom: 0.5rem;">
                            ì™¸ë¶€ í”ŒëŸ¬ê·¸ì¸ íŒŒë¼ë¯¸í„°ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ í¸ì§‘í•˜ì„¸ìš”. 
                            <a href="plugins/README-${activity.template.split('@')[0].toUpperCase().replace(/-/g, '-')}.md" 
                               target="_blank" style="color: #89b4fa;">
                               ğŸ“– ë¬¸ì„œ ë³´ê¸°
                            </a>
                        </p>
                        <textarea class="form-input form-textarea" 
                                  id="plugin-params-json" 
                                  rows="20"
                                  style="font-family: 'Courier New', monospace; font-size: 0.9rem;"
                                  placeholder="JSON íŒŒë¼ë¯¸í„°ë¥¼ ì…ë ¥í•˜ì„¸ìš”">${JSON.stringify(activity.params, null, 2)}</textarea>
                        <div id="json-validation-error" style="color: #f38ba8; margin-top: 0.5rem; display: none;"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">í…œí”Œë¦¿ ì •ë³´</label>
                        <div style="background: #45475a; padding: 1rem; border-radius: 8px;">
                            <div style="margin-bottom: 0.5rem;">
                                <strong>í…œí”Œë¦¿:</strong> ${activity.template}
                            </div>
                            <div style="margin-bottom: 0.5rem;">
                                <strong>Activity ID:</strong> ${activity.activityId}
                            </div>
                            <div>
                                <strong>íƒ€ì…:</strong> ì™¸ë¶€ í”ŒëŸ¬ê·¸ì¸
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn" onclick="validateAndUpdatePluginParams()">âœ… íŒŒë¼ë¯¸í„° ì ìš©</button>
                </div>
            `;
        }
        
        // í”ŒëŸ¬ê·¸ì¸ íŒŒë¼ë¯¸í„° ê²€ì¦ ë° ì—…ë°ì´íŠ¸
        function validateAndUpdatePluginParams() {
            const jsonTextarea = document.getElementById('plugin-params-json');
            const errorDiv = document.getElementById('json-validation-error');
            
            try {
                const params = JSON.parse(jsonTextarea.value);
                
                // í˜„ì¬ í™œë™ ì—…ë°ì´íŠ¸
                if (currentActivity) {
                    currentActivity.params = params;
                    errorDiv.style.display = 'none';
                    updateJsonPreview();
                    
                    // ì„±ê³µ ë©”ì‹œì§€
                    errorDiv.textContent = 'âœ… íŒŒë¼ë¯¸í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.';
                    errorDiv.style.color = '#a6e3a1';
                    errorDiv.style.display = 'block';
                    
                    setTimeout(() => {
                        errorDiv.style.display = 'none';
                    }, 3000);
                }
            } catch (error) {
                errorDiv.textContent = 'âŒ JSON íŒŒì‹± ì˜¤ë¥˜: ' + error.message;
                errorDiv.style.color = '#f38ba8';
                errorDiv.style.display = 'block';
            }
        }
        
        // í¸ì§‘ê¸° ì´ë²¤íŠ¸ ì—°ê²°
        function attachEditorEvents() {
            // ëª¨ë“  ì…ë ¥ í•„ë“œì— change ì´ë²¤íŠ¸ ì—°ê²°
            const inputs = document.querySelectorAll('#edit-tab input, #edit-tab textarea, #edit-tab select');
            inputs.forEach(input => {
                input.addEventListener('input', updateActivityFromEditor);
                input.addEventListener('change', updateActivityFromEditor);
            });
        }
        
        // í¸ì§‘ê¸°ì—ì„œ í™œë™ ì—…ë°ì´íŠ¸
        function updateActivityFromEditor() {
            if (selectedActivityIndex < 0) return;
            
            const activity = activities[selectedActivityIndex];
            const templateType = activity.template.split('@')[0];
            
            switch (templateType) {
                case 'multiple-choice':
                    updateMultipleChoiceActivity(activity);
                    break;
                case 'word-guess':
                    updateWordGuessActivity(activity);
                    break;
                case 'memory-game':
                    updateMemoryGameActivity(activity);
                    break;
                case 'video':
                    updateVideoActivity(activity);
                    break;
                case 'quiz':
                    updateQuizActivity(activity);
                    break;
                case 'survey':
                    updateSurveyActivity(activity);
                    break;
            }
            
            renderActivityList();
            updateJsonPreview();
            updateButtonStates();
        }
        
        // 4ì§€ ì„ ë‹¤í˜• ì—…ë°ì´íŠ¸
        function updateMultipleChoiceActivity(activity) {
            const question = document.getElementById('question')?.value || '';
            const timeLimit = parseInt(document.getElementById('time-limit')?.value) || 30;
            const explanation = document.getElementById('explanation')?.value || '';
            const allowMultiple = document.getElementById('allow-multiple')?.checked || false;
            
            // ì„ íƒì§€ ì—…ë°ì´íŠ¸
            const choiceInputs = document.querySelectorAll('.choice-input');
            const choiceChecks = document.querySelectorAll('.choice-correct');
            const choices = [];
            const correctAnswers = [];
            
            choiceInputs.forEach((input, index) => {
                const choiceId = input.dataset.choiceId;
                const text = input.value;
                const isCorrect = choiceChecks[index]?.checked;
                
                choices.push({ id: choiceId, text: text });
                if (isCorrect) {
                    correctAnswers.push(choiceId);
                }
            });
            
            activity.params = {
                ...activity.params,
                question: question,
                choices: choices,
                correctAnswer: allowMultiple ? correctAnswers : correctAnswers[0] || choices[0]?.id,
                allowMultiple: allowMultiple,
                timeLimit: timeLimit,
                explanation: explanation
            };
        }
        
        // ë‹¨ì–´ ë§ì¶”ê¸° ì—…ë°ì´íŠ¸
        function updateWordGuessActivity(activity) {
            activity.params = {
                ...activity.params,
                word: document.getElementById('word')?.value || '',
                hint: document.getElementById('hint')?.value || '',
                category: document.getElementById('category')?.value || '',
                maxAttempts: parseInt(document.getElementById('max-attempts')?.value) || 6,
                timeLimit: parseInt(document.getElementById('time-limit')?.value) || 120
            };
        }
        
        // ë©”ëª¨ë¦¬ ê²Œì„ ì—…ë°ì´íŠ¸
        function updateMemoryGameActivity(activity) {
            const title = document.getElementById('game-title')?.value || '';
            const timeLimit = parseInt(document.getElementById('time-limit')?.value) || 120;
            const successMessage = document.getElementById('success-message')?.value || '';
            
            // ì¹´ë“œ ì—…ë°ì´íŠ¸
            const cardInputs = document.querySelectorAll('#card-builder input[data-match-id]');
            const cards = [];
            
            cardInputs.forEach((input, index) => {
                const matchId = input.dataset.matchId;
                const cardIndex = input.dataset.cardIndex;
                const content = input.value;
                
                cards.push({
                    id: `card-${matchId}-${cardIndex}`,
                    content: content,
                    type: 'text',
                    matchId: matchId
                });
            });
            
            activity.params = {
                ...activity.params,
                title: title,
                cards: cards,
                timeLimit: timeLimit,
                successMessage: successMessage
            };
        }
        
        // ë¹„ë””ì˜¤ ì—…ë°ì´íŠ¸
        function updateVideoActivity(activity) {
            activity.params = {
                ...activity.params,
                title: document.getElementById('video-title')?.value || '',
                src: document.getElementById('video-src')?.value || '',
                description: document.getElementById('video-description')?.value || ''
            };
        }
        
        // í€´ì¦ˆ ì—…ë°ì´íŠ¸
        function updateQuizActivity(activity) {
            const question = document.getElementById('question')?.value || '';
            const correctAnswer = document.getElementById('correct-answer')?.value || '';
            const choiceInputs = document.querySelectorAll('[data-choice-index]');
            const choices = [];
            
            choiceInputs.forEach(input => {
                choices.push(input.value);
            });
            
            activity.params = {
                ...activity.params,
                question: question,
                choices: choices,
                correct: correctAnswer
            };
        }
        
        // Survey ì—…ë°ì´íŠ¸ - ìƒˆë¡œìš´ í…œí”Œë¦¿!
        function updateSurveyActivity(activity) {
            const questions = [];
            const questionElements = document.querySelectorAll('#survey-questions .card');
            
            questionElements.forEach((element, index) => {
                const questionText = element.querySelector(`textarea[data-question-index="${index}"]`)?.value || '';
                const questionType = element.querySelector(`select[data-question-index="${index}"]`)?.value || 'multiple-choice';
                const required = element.querySelector(`input[data-question-index="${index}"][data-field="required"]`)?.checked || false;
                
                const question = {
                    type: questionType,
                    question: questionText,
                    required: required
                };
                
                if (questionType === 'multiple-choice') {
                    const optionInputs = element.querySelectorAll(`input[data-question-index="${index}"][data-option-index]`);
                    question.options = Array.from(optionInputs).map(input => input.value);
                } else if (questionType === 'rating') {
                    const scaleInput = element.querySelector(`input[data-question-index="${index}"][data-field="scale"]`);
                    question.scale = parseInt(scaleInput?.value) || 5;
                    question.scaleLabels = ['ë§¤ìš° ë‚˜ì¨', 'ë§¤ìš° ì¢‹ìŒ'];
                }
                
                questions.push(question);
            });
            
            activity.params = {
                ...activity.params,
                questions: questions
            };
        }
        
        // ì„ íƒì§€ ì¶”ê°€
        window.addChoice = function() {
            const choiceBuilder = document.getElementById('choice-builder');
            const choiceCount = choiceBuilder.children.length;
            const choiceId = `choice-${String.fromCharCode(97 + choiceCount)}`;
            
            const choiceHtml = `
                <div class="choice-item">
                    <input type="text" class="form-input choice-input" 
                           value="ìƒˆ ì„ íƒì§€" 
                           data-choice-id="${choiceId}"
                           placeholder="ì„ íƒì§€ ${choiceCount + 1}">
                    <input type="checkbox" class="choice-correct" 
                           data-choice-id="${choiceId}">
                    <button class="btn btn-danger" onclick="removeChoice('${choiceId}')">ğŸ—‘ï¸</button>
                </div>
            `;
            
            choiceBuilder.insertAdjacentHTML('beforeend', choiceHtml);
            attachEditorEvents();
        };
        
        // ì„ íƒì§€ ì œê±°
        window.removeChoice = function(choiceId) {
            const choiceItem = document.querySelector(`[data-choice-id="${choiceId}"]`).parentElement;
            choiceItem.remove();
            updateActivityFromEditor();
        };
        
        // ì¹´ë“œ ìŒ ì¶”ê°€
        window.addCardPair = function() {
            const cardBuilder = document.getElementById('card-builder');
            const pairCount = cardBuilder.children.length;
            const matchId = `pair-${pairCount + 1}`;
            
            const pairHtml = `
                <div class="card" style="margin-bottom: 1rem; background: #313244;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <span>ì¹´ë“œ ìŒ ${pairCount + 1}</span>
                        <button class="btn btn-danger" onclick="removeCardPair('${matchId}')">ğŸ—‘ï¸ ì‚­ì œ</button>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <label class="form-label">ì¹´ë“œ A</label>
                            <input type="text" class="form-input" value="ì¹´ë“œ A" 
                                   data-match-id="${matchId}" data-card-index="0">
                        </div>
                        <div>
                            <label class="form-label">ì¹´ë“œ B</label>
                            <input type="text" class="form-input" value="ì¹´ë“œ B" 
                                   data-match-id="${matchId}" data-card-index="1">
                        </div>
                    </div>
                </div>
            `;
            
            cardBuilder.insertAdjacentHTML('beforeend', pairHtml);
            attachEditorEvents();
        };
        
        // ì¹´ë“œ ìŒ ì œê±°
        window.removeCardPair = function(matchId) {
            const pairElement = document.querySelector(`[data-match-id="${matchId}"]`).closest('.card');
            pairElement.remove();
            updateActivityFromEditor();
        };
        
        // Survey í¸ì§‘ ë„ìš°ë¯¸ í•¨ìˆ˜ë“¤ - ìƒˆë¡œìš´ í…œí”Œë¦¿!
        window.addSurveyQuestion = function() {
            const activity = activities[selectedActivityIndex];
            activity.params.questions.push({
                type: 'multiple-choice',
                question: 'ìƒˆ ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”',
                options: ['ì˜µì…˜ 1', 'ì˜µì…˜ 2'],
                required: true
            });
            renderActivityEditor(activity);
            attachEditorEvents();
        };
        
        window.removeSurveyQuestion = function(index) {
            const activity = activities[selectedActivityIndex];
            activity.params.questions.splice(index, 1);
            renderActivityEditor(activity);
            attachEditorEvents();
        };
        
        window.addSurveyOption = function(questionIndex) {
            const activity = activities[selectedActivityIndex];
            activity.params.questions[questionIndex].options.push('ìƒˆ ì˜µì…˜');
            renderActivityEditor(activity);
            attachEditorEvents();
        };
        
        window.updateQuestionType = function(index, newType) {
            const activity = activities[selectedActivityIndex];
            const question = activity.params.questions[index];
            
            question.type = newType;
            
            // íƒ€ì…ë³„ ê¸°ë³¸ê°’ ì„¤ì •
            if (newType === 'multiple-choice' && !question.options) {
                question.options = ['ì˜µì…˜ 1', 'ì˜µì…˜ 2'];
            } else if (newType === 'rating' && !question.scale) {
                question.scale = 5;
                question.scaleLabels = ['ë§¤ìš° ë‚˜ì¨', 'ë§¤ìš° ì¢‹ìŒ'];
            }
            
            renderActivityEditor(activity);
            attachEditorEvents();
        };
        
        // í™œë™ ì‚­ì œ
        function deleteActivity() {
            if (selectedActivityIndex < 0) return;
            
            if (confirm('ì´ í™œë™ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                activities.splice(selectedActivityIndex, 1);
                currentLesson.flow.splice(selectedActivityIndex, 1);
                
                selectedActivityIndex = -1;
                renderActivityList();
                hideActivityEditor();
                updateButtonStates();
                
                showNotification('í™œë™ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'warning');
            }
        }
        
        // íƒ­ ì „í™˜
        function switchTab(tabName) {
            // íƒ­ í™œì„±í™”
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // ì½˜í…ì¸  í‘œì‹œ
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // JSON íƒ­ì¸ ê²½ìš° ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
            if (tabName === 'json') {
                updateJsonPreview();
            }
        }
        
        // JSON ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
        function updateJsonPreview() {
            if (selectedActivityIndex >= 0) {
                const jsonPreview = document.getElementById('json-preview');
                if (jsonPreview) {
                    jsonPreview.textContent = JSON.stringify(activities[selectedActivityIndex], null, 2);
                }
            }
        }
        
        // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateButtonStates() {
            const hasTitle = currentLesson.title.trim().length > 0;
            const hasActivities = activities.length > 0;
            
            saveLessonBtn.disabled = !(hasTitle && hasActivities);
            previewLessonBtn.disabled = !(hasTitle && hasActivities);
            exportJsonBtn.disabled = !(hasTitle && hasActivities);
        }
        
        // ë ˆìŠ¨ ì €ì¥
        function saveLesson() {
            try {
                currentLesson.flow = activities;
                currentLesson.metadata.createdAt = new Date().toISOString();
                
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
                const savedLessons = JSON.parse(localStorage.getItem('savedLessons') || '[]');
                const existingIndex = savedLessons.findIndex(lesson => lesson.lessonId === currentLesson.lessonId);
                
                if (existingIndex >= 0) {
                    savedLessons[existingIndex] = currentLesson;
                    showNotification('ë ˆìŠ¨ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                } else {
                    savedLessons.push(currentLesson);
                    showNotification('ë ˆìŠ¨ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                }
                
                localStorage.setItem('savedLessons', JSON.stringify(savedLessons));
                
            } catch (error) {
                console.error('ë ˆìŠ¨ ì €ì¥ ì˜¤ë¥˜:', error);
                showNotification('ë ˆìŠ¨ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }
        
        // ë ˆìŠ¨ ë¯¸ë¦¬ë³´ê¸°
        function previewLesson() {
            currentLesson.flow = activities;
            
            // ë¯¸ë¦¬ë³´ê¸° ì°½ ì—´ê¸°
            const previewWindow = window.open('', '_blank', 'width=1200,height=800');
            previewWindow.document.write(`
                <html>
                    <head>
                        <title>ë ˆìŠ¨ ë¯¸ë¦¬ë³´ê¸°: ${currentLesson.title}</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 20px; }
                            .preview-header { background: #f0f0f0; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
                            .activity { background: #fff; border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 8px; }
                            .activity-type { color: #666; font-size: 12px; text-transform: uppercase; font-weight: bold; }
                            .activity-title { font-size: 18px; font-weight: bold; margin: 10px 0; }
                            .choices { margin: 10px 0; }
                            .choice { background: #f9f9f9; padding: 8px; margin: 5px 0; border-radius: 4px; }
                            .correct { background: #d4edda; }
                        </style>
                    </head>
                    <body>
                        <div class="preview-header">
                            <h1>${currentLesson.title}</h1>
                            <p>${currentLesson.description}</p>
                            <small>ë‚œì´ë„: ${currentLesson.metadata.difficulty} | ì˜ˆìƒ ì‹œê°„: ${currentLesson.metadata.estimatedTime}ë¶„</small>
                        </div>
                        
                        ${activities.map((activity, index) => {
                            const templateType = activity.template.split('@')[0];
                            return `
                                <div class="activity">
                                    <div class="activity-type">${templateType}</div>
                                    <div class="activity-title">í™œë™ ${index + 1}: ${activity.params.question || activity.params.title || activity.activityId}</div>
                                    ${renderActivityPreview(activity)}
                                </div>
                            `;
                        }).join('')}
                    </body>
                </html>
            `);
        }
        
        // í™œë™ ë¯¸ë¦¬ë³´ê¸° ë Œë”ë§
        function renderActivityPreview(activity) {
            const templateType = activity.template.split('@')[0];
            const params = activity.params;
            
            switch (templateType) {
                case 'multiple-choice':
                    return `
                        <div class="choices">
                            ${params.choices.map(choice => {
                                const isCorrect = Array.isArray(params.correctAnswer) 
                                    ? params.correctAnswer.includes(choice.id)
                                    : params.correctAnswer === choice.id;
                                return `<div class="choice ${isCorrect ? 'correct' : ''}">${choice.text} ${isCorrect ? '(ì •ë‹µ)' : ''}</div>`;
                            }).join('')}
                        </div>
                        ${params.explanation ? `<p><strong>ì„¤ëª…:</strong> ${params.explanation}</p>` : ''}
                    `;
                    
                case 'word-guess':
                    return `
                        <p><strong>ì •ë‹µ:</strong> ${params.word}</p>
                        <p><strong>íŒíŠ¸:</strong> ${params.hint}</p>
                        <p><strong>ì¹´í…Œê³ ë¦¬:</strong> ${params.category}</p>
                        <p><strong>ìµœëŒ€ ì‹œë„:</strong> ${params.maxAttempts}íšŒ</p>
                    `;
                    
                case 'memory-game':
                    const pairs = [];
                    const processedMatchIds = new Set();
                    
                    params.cards.forEach(card => {
                        if (!processedMatchIds.has(card.matchId)) {
                            const matchingCards = params.cards.filter(c => c.matchId === card.matchId);
                            if (matchingCards.length === 2) {
                                pairs.push(matchingCards);
                                processedMatchIds.add(card.matchId);
                            }
                        }
                    });
                    
                    return `
                        <div class="choices">
                            ${pairs.map((pair, index) => 
                                `<div class="choice">ìŒ ${index + 1}: "${pair[0].content}" â†” "${pair[1].content}"</div>`
                            ).join('')}
                        </div>
                    `;
                    
                case 'video':
                    return `
                        <p><strong>ë¹„ë””ì˜¤ URL:</strong> ${params.src}</p>
                        <p>${params.description}</p>
                    `;
                    
                case 'quiz':
                    return `
                        <div class="choices">
                            ${params.choices.map(choice => 
                                `<div class="choice ${choice === params.correct ? 'correct' : ''}">${choice} ${choice === params.correct ? '(ì •ë‹µ)' : ''}</div>`
                            ).join('')}
                        </div>
                    `;
                    
                case 'survey':
                    return `
                        <div class="choices">
                            ${params.questions.map((question, index) => `
                                <div class="choice">
                                    <strong>Q${index + 1}:</strong> ${question.question} 
                                    <span style="color: #fab387;">[${question.type}]</span>
                                    ${question.required ? ' <span style="color: #f38ba8;">*</span>' : ''}
                                </div>
                            `).join('')}
                        </div>
                    `;
                    
                default:
                    return '<p>ë¯¸ë¦¬ë³´ê¸°ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
        }
        
        // JSON ë‚´ë³´ë‚´ê¸°
        function exportJson() {
            currentLesson.flow = activities;
            const jsonData = JSON.stringify(currentLesson, null, 2);
            
            // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentLesson.lessonId}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('JSON íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }
        
        // ì•Œë¦¼ í‘œì‹œ
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, 300);
            }, 3000);
        }
        
        // ì´ˆê¸°í™”
        console.log('ğŸ“š ë ˆìŠ¨ ë¹Œë”ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!');
        updateButtonStates();
    </script>
</body>
</html>