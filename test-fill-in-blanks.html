<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fill in the Blanks Plugin Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #312e81 100%);
            min-height: 100vh;
            padding: 2rem;
        }

        .test-header {
            text-align: center;
            color: white;
            margin-bottom: 2rem;
        }

        .test-header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .test-header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .test-controls {
            max-width: 900px;
            margin: 0 auto 2rem;
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .control-group {
            margin-bottom: 1rem;
        }

        .control-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #2d3748;
        }

        .control-group select,
        .control-group input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
        }

        .control-group button {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-group button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        #activity-container {
            min-height: 400px;
        }

        .status-indicator {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            max-width: 300px;
        }

        .status-indicator h3 {
            font-size: 1rem;
            margin-bottom: 0.5rem;
            color: #2d3748;
        }

        .status-indicator .status-item {
            padding: 0.5rem 0;
            font-size: 0.9rem;
            color: #4a5568;
            border-bottom: 1px solid #e2e8f0;
        }

        .status-indicator .status-item:last-child {
            border-bottom: none;
        }

        .event-log {
            max-width: 900px;
            margin: 2rem auto;
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .event-log h3 {
            margin-bottom: 1rem;
            color: #2d3748;
        }

        .event-log pre {
            background: #f7fafc;
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.85rem;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="test-header">
        <h1>âœï¸ Fill in the Blanks Plugin Test</h1>
        <p>ë¹ˆì¹¸ ì±„ìš°ê¸° í”ŒëŸ¬ê·¸ì¸ í…ŒìŠ¤íŠ¸ í˜ì´ì§€</p>
    </div>

    <div class="test-controls">
        <div class="control-group">
            <label for="test-scenario">í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ</label>
            <select id="test-scenario">
                <option value="basic">ê¸°ë³¸ í…ŒìŠ¤íŠ¸ (ê°„ë‹¨í•œ ë¬¸ì¥)</option>
                <option value="multiple">ë³µìˆ˜ ë¹ˆì¹¸ í…ŒìŠ¤íŠ¸</option>
                <option value="hints">íŒíŠ¸ í¬í•¨ í…ŒìŠ¤íŠ¸</option>
                <option value="timer">íƒ€ì´ë¨¸ í…ŒìŠ¤íŠ¸ (30ì´ˆ)</option>
                <option value="alternatives">ëŒ€ì²´ ì •ë‹µ í…ŒìŠ¤íŠ¸</option>
                <option value="complex">ë³µì¡í•œ ë¬¸ì¥ í…ŒìŠ¤íŠ¸</option>
            </select>
        </div>
        <div class="control-group">
            <button id="load-test-btn">í…ŒìŠ¤íŠ¸ ë¡œë“œ</button>
        </div>
    </div>

    <div id="activity-container"></div>

    <div class="status-indicator">
        <h3>ğŸ“Š ìƒíƒœ</h3>
        <div class="status-item" id="status-plugin">í”ŒëŸ¬ê·¸ì¸: ëŒ€ê¸° ì¤‘</div>
        <div class="status-item" id="status-activity">ì•¡í‹°ë¹„í‹°: ì—†ìŒ</div>
        <div class="status-item" id="status-events">ì´ë²¤íŠ¸: 0ê°œ</div>
    </div>

    <div class="event-log">
        <h3>ğŸ“ ì´ë²¤íŠ¸ ë¡œê·¸</h3>
        <pre id="event-log-output">ì´ë²¤íŠ¸ ëŒ€ê¸° ì¤‘...</pre>
    </div>

    <!-- í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œ ë¡œë“œ -->
    <script src="plugin-system.js"></script>
    
    <!-- Fill in the Blanks í”ŒëŸ¬ê·¸ì¸ ë¡œë“œ -->
    <script src="plugins/fill-in-blanks-plugin.js"></script>

    <!-- í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        // ì´ë²¤íŠ¸ ë¡œê·¸
        const eventLog = [];
        let currentActivity = null;

        // í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
        const testScenarios = {
            basic: {
                title: 'ê¸°ë³¸ ë¹ˆì¹¸ ì±„ìš°ê¸°',
                sentence: 'ê³ ì–‘ì´ê°€ {blank}ë¥¼ ì«“ì•„ê°„ë‹¤.',
                blanks: [
                    { id: 'blank-1', position: '{blank}', answer: 'ì¥' }
                ],
                showHints: false,
                timeLimit: 0
            },
            multiple: {
                title: 'ë³µìˆ˜ ë¹ˆì¹¸ í…ŒìŠ¤íŠ¸',
                sentence: 'ë‚˜ëŠ” {blank1}ì—ì„œ {blank2}ë¥¼ ê³µë¶€í•©ë‹ˆë‹¤.',
                blanks: [
                    { id: 'blank-1', position: '{blank1}', answer: 'í•™êµ' },
                    { id: 'blank-2', position: '{blank2}', answer: 'ìˆ˜í•™' }
                ],
                showHints: false,
                timeLimit: 0
            },
            hints: {
                title: 'íŒíŠ¸ í¬í•¨ í…ŒìŠ¤íŠ¸',
                sentence: 'í•œêµ­ì˜ ìˆ˜ë„ëŠ” {blank}ì…ë‹ˆë‹¤.',
                blanks: [
                    { id: 'blank-1', position: '{blank}', answer: 'ì„œìš¸' }
                ],
                showHints: true,
                hints: [
                    'ëŒ€í•œë¯¼êµ­ì˜ ìˆ˜ë„',
                    'í•œê°•ì´ íë¥´ëŠ” ë„ì‹œ',
                    'ì¸êµ¬ê°€ ê°€ì¥ ë§ì€ ë„ì‹œ'
                ],
                timeLimit: 0
            },
            timer: {
                title: 'íƒ€ì´ë¨¸ í…ŒìŠ¤íŠ¸ (30ì´ˆ)',
                sentence: '2 + 2 = {blank}',
                blanks: [
                    { id: 'blank-1', position: '{blank}', answer: '4' }
                ],
                showHints: false,
                timeLimit: 30
            },
            alternatives: {
                title: 'ëŒ€ì²´ ì •ë‹µ í…ŒìŠ¤íŠ¸',
                sentence: 'ê°€ì¥ í° ë™ë¬¼ì€ {blank}ì…ë‹ˆë‹¤.',
                blanks: [
                    { 
                        id: 'blank-1', 
                        position: '{blank}', 
                        answer: 'ê³ ë˜',
                        alternatives: ['ê³ ë˜', 'í°ìˆ˜ì—¼ê³ ë˜', 'ëŒ€ì™•ê³ ë˜']
                    }
                ],
                showHints: true,
                hints: ['ë°”ë‹¤ì— ì‚¬ëŠ” ë™ë¬¼', 'í¬ìœ ë¥˜ì…ë‹ˆë‹¤'],
                timeLimit: 0
            },
            complex: {
                title: 'ë³µì¡í•œ ë¬¸ì¥ í…ŒìŠ¤íŠ¸',
                sentence: 'ì„¸ì¢…ëŒ€ì™•ì€ {blank1}ì„ ì°½ì œí•˜ì—¬ {blank2}ì„ ë„“íˆê³ , ë°±ì„±ë“¤ì´ {blank3}ì„ ë°°ìš¸ ìˆ˜ ìˆë„ë¡ í–ˆìŠµë‹ˆë‹¤.',
                blanks: [
                    { id: 'blank-1', position: '{blank1}', answer: 'í•œê¸€' },
                    { id: 'blank-2', position: '{blank2}', answer: 'ë¬¸ì' },
                    { id: 'blank-3', position: '{blank3}', answer: 'ê¸€' }
                ],
                showHints: true,
                hints: [
                    'ìš°ë¦¬ë‚˜ë¼ ê³ ìœ ì˜ ë¬¸ì',
                    'ì†Œí†µì˜ ìˆ˜ë‹¨',
                    'ì½ê³  ì“°ëŠ” ê²ƒ'
                ],
                timeLimit: 0,
                caseSensitive: false
            }
        };

        // ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateStatus(type, message) {
            const statusEl = document.getElementById(`status-${type}`);
            if (statusEl) {
                statusEl.textContent = message;
            }
        }

        // ì´ë²¤íŠ¸ ë¡œê·¸ ì¶”ê°€
        function addEventLog(event, data) {
            const timestamp = new Date().toLocaleTimeString('ko-KR');
            eventLog.push({ timestamp, event, data });
            
            const logOutput = document.getElementById('event-log-output');
            if (logOutput) {
                logOutput.textContent = JSON.stringify(eventLog, null, 2);
                logOutput.scrollTop = logOutput.scrollHeight;
            }
            
            updateStatus('events', `ì´ë²¤íŠ¸: ${eventLog.length}ê°œ`);
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        if (window.PluginSystem) {
            window.PluginSystem.on('activity:started', (data) => {
                addEventLog('activity:started', data);
                updateStatus('activity', 'ì•¡í‹°ë¹„í‹°: ì‹¤í–‰ ì¤‘');
            });

            window.PluginSystem.on('activity:completed', (data) => {
                addEventLog('activity:completed', data);
                updateStatus('activity', 'ì•¡í‹°ë¹„í‹°: ì™„ë£Œ');
                
                // ì™„ë£Œ ì•Œë¦¼
                setTimeout(() => {
                    alert(`ğŸ‰ ì™„ë£Œ!\n\nì ìˆ˜: ${(data.score * 100).toFixed(0)}%\nì‹œê°„: ${(data.durationMs / 1000).toFixed(1)}ì´ˆ\nì‹œë„: ${data.attempts}ë²ˆ`);
                }, 500);
            });

            window.PluginSystem.on('activity:timeout', (data) => {
                addEventLog('activity:timeout', data);
                updateStatus('activity', 'ì•¡í‹°ë¹„í‹°: ì‹œê°„ ì´ˆê³¼');
            });

            updateStatus('plugin', 'í”ŒëŸ¬ê·¸ì¸: ë¡œë“œ ì™„ë£Œ âœ…');
        } else {
            updateStatus('plugin', 'í”ŒëŸ¬ê·¸ì¸: ë¡œë“œ ì‹¤íŒ¨ âŒ');
        }

        // í…ŒìŠ¤íŠ¸ ë¡œë“œ ë²„íŠ¼
        document.getElementById('load-test-btn').addEventListener('click', () => {
            const scenarioId = document.getElementById('test-scenario').value;
            const scenario = testScenarios[scenarioId];
            
            if (!scenario) {
                alert('ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }

            // ì´ì „ ë¡œê·¸ ì´ˆê¸°í™”
            eventLog.length = 0;
            document.getElementById('event-log-output').textContent = 'ì´ë²¤íŠ¸ ëŒ€ê¸° ì¤‘...';
            updateStatus('events', 'ì´ë²¤íŠ¸: 0ê°œ');

            // ì•¡í‹°ë¹„í‹° ìƒì„±
            currentActivity = {
                activityId: `test-${scenarioId}-${Date.now()}`,
                template: 'fill-in-blanks@1.0.0',
                params: scenario
            };

            // ë Œë”ë§
            const container = document.getElementById('activity-container');
            window.PluginSystem.renderActivity(currentActivity, container);

            addEventLog('test:loaded', { scenarioId, activity: currentActivity });
            console.log('ğŸ§ª í…ŒìŠ¤íŠ¸ ë¡œë“œ:', currentActivity);
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ë¡œë“œ
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                document.getElementById('load-test-btn').click();
            }, 500);
        });

        // ë””ë²„ê·¸ìš© ì „ì—­ í•¨ìˆ˜
        window.getActivityState = function() {
            return currentActivity;
        };

        window.getEventLog = function() {
            return eventLog;
        };

        console.log('ğŸ§ª í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ì´ˆê¸°í™” ì™„ë£Œ');
        console.log('ğŸ’¡ íŒ: getActivityState(), getEventLog() í•¨ìˆ˜ë¡œ ìƒíƒœ í™•ì¸ ê°€ëŠ¥');
    </script>
</body>
</html>
